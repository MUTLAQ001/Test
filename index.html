<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="راقب غيابك بأسلوب لم تره من قبل، مع خلفية كونية تفاعلية.">
	<meta name="theme-color" content="#0a0a0a">
	<title>حاسبة الغياب الكونية</title>
	<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22short_name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22description%22%3A%22%D8%B1%D8%A7%D9%82%D8%A8%20%D8%BA%D9%8A%D8%A7%D8%A8%D9%83%20%D8%A8%D8%A3%D8%B3%D9%84%D9%88%D8%A8%20%D9%84%D9%85%20%D8%AA%D8%B1%D9%87%20%D9%85%D9%86%20%D9%82%D8%A8%D9%84.%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230a0a0a%22%2C%22theme_color%22%3A%22%230a0a0a%22%2C%22orientation%22%3A%22portrait-primary%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI%2BPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSI0MjAiIHI9IjMyIi8%2BPC9nPjwvZz48L3N2Zz4%3D%22%2C%22sizes%22%3A%22192x1192%20512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
	<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA tribulationsPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iMjQwIiByPSIzMiIvPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjMzMCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iMzMwIiByPSIzMiIvPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjQyMCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8+PGNpcmNsZSBjeD0iMzYyIiBjeT0iNDIwIiByPSIzMiIvPjwvZz48L2c+PC9zdmc+">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="حاسبة الغياب">
	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<style>
		@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap");
		@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap");
		:root{--color-primary:#5e9cff;--color-primary-dark:#4b7dcc;--color-danger-red:#ff5252;--color-warning-gold:#ffc400;--color-save-green:#00c853;--color-bg:#0a0a0a;--color-card:rgba(20,20,22,0.75);--color-border:rgba(255,255,255,0.1);--color-text:#e0e0e0;--color-text-muted:#999;--font-body:"Cairo",sans-serif;--font-title:"IBM Plex Sans Arabic",sans-serif;--radius:20px;--radius-md:16px;--radius-full:999px;--transition:0.3s cubic-bezier(0.25,0.8,0.25,1);--transition-smooth:0.5s cubic-bezier(0.2,0.8,0.2,1);--rgb-primary:94,156,255;--rgb-warning:255,196,0;--rgb-danger:255,82,82;--primary-hue:217;--secondary-hue:257;}
		* {
			margin:0;
			padding:0;
			box-sizing:border-box;
			-webkit-tap-highlight-color: transparent;
		}
		html{scroll-behavior:smooth}
		body.modal-open { 
            overflow: hidden !important;
            padding-right: var(--scrollbar-width, 0) !important;
        }

		::-webkit-scrollbar{width:8px}
		::-webkit-scrollbar-track{background:var(--color-bg);transition:background-color var(--transition-smooth)}
		::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:4px;border:2px solid transparent;background-clip:content-box}
		.light-mode ::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.2)}
		
        @keyframes gradient-animation{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
		@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
		@keyframes fadeOut{to{opacity:0;transform:scale(.95)}}
		@keyframes fadeIn{from{opacity:0}to{opacity:1}}
		@keyframes glow-update{0%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}50%{box-shadow:0 0 20px 5px rgba(var(--rgb-primary),0.4)}100%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}}
		@keyframes swal-scale-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
		@keyframes swal-scale-out { from { transform: scale(1); opacity: 1; } to { transform: scale(0.9); opacity: 0; } }
		@keyframes move-nebula{0%{transform:translate(0,0) rotate(0deg) scale(1.2)}50%{transform:translate(10vw,5vh) rotate(180deg) scale(1.5)}100%{transform:translate(0,0) rotate(360deg) scale(1.2)}}
		
		*:focus-visible{outline:2px solid var(--color-primary);outline-offset:3px;border-radius:6px}
        .swal-popup-animation-in { animation: swal-scale-in 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
		.swal-popup-animation-out { animation: swal-scale-out 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) forwards; }
		body{font-family:var(--font-body);background-color:var(--color-bg);color:var(--color-text);direction:rtl;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale; transition: background-color var(--transition-smooth), color var(--transition-smooth);}
		
        .cosmic-bg-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;overflow:hidden}
		#starfield-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
		.nebula-glow{position:absolute;top:50%;left:50%;width:80vmax;height:80vmax;margin-top:-40vmax;margin-left:-40vmax;background:radial-gradient(circle,hsl(var(--primary-hue),90%,60%,.15) 0%,hsl(var(--secondary-hue),80%,50%,.1) 40%,transparent 70%);filter:blur(100px);border-radius:50%;animation:move-nebula 90s infinite alternate ease-in-out;transition:opacity .5s ease,background .5s ease}
		.light-mode .nebula-glow{opacity:.5;filter:blur(120px)}
		
        .app{min-height:100vh;position:relative;padding:2rem 1rem; perspective: 2000px;}
		.container{width:100%;max-width:600px;z-index:1;display:flex;flex-direction:column;gap:1.5rem;margin:0 auto;position:relative}
		.header{text-align:center;animation:fadeInUp .8s var(--transition-smooth) both}
		.title{font-family:var(--font-title);font-weight:700;font-size:2.8rem;margin-bottom:0.25rem;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% 200%;animation:gradient-animation 5s ease-in-out infinite;}
		.subtitle{color:var(--color-text-muted);font-size:1rem;animation:fadeInUp .8s var(--transition-smooth) .2s both; letter-spacing: 0.5px;}
		
        #main-calculator-card { transform-style: preserve-3d; transition: transform 0.1s linear; }
        #main-calculator-card::after {
            content:''; position:absolute; top:0; left:0; width:100%; height:100%;
            background:radial-gradient(circle at var(--mouse-x,50%) var(--mouse-y,50%),hsla(0,0%,100%,0.08),transparent 40%);
            opacity:0; transition:opacity .4s ease; pointer-events:none; border-radius:var(--radius);
        }
        #main-calculator-card:hover::after { opacity:1; }

        .card{
            background:var(--color-card);
            border:1px solid var(--color-border);
            border-radius:var(--radius);
            padding:1.5rem;
            backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
            transition: background-color var(--transition-smooth), border-color var(--transition-smooth), box-shadow var(--transition-smooth);
            position:relative;
            animation:scaleIn .8s var(--transition-smooth) .4s both;
            box-shadow: 0 16px 40px -12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
        }
		.card.safe{--status-color:var(--color-primary);--rgb-status:var(--rgb-primary)}
		.card.warning{--status-color:var(--color-warning-gold);--rgb-status:var(--rgb-warning)}
		.card.danger{--status-color:var(--color-danger-red);--rgb-status:var(--rgb-danger)}
		.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid var(--color-border); transition: border-color var(--transition-smooth);}
		.card-header h2{font-family:var(--font-title);font-weight:700;font-size:1.7rem;color:#fff;display:flex;align-items:center;gap:0.75rem; transition: color var(--transition-smooth);}
		.card-header-controls{display:flex;align-items:center;gap:0.5rem;}
		.input-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1.25rem;align-items:flex-end; padding-top: 1rem;}
		.label-with-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
		.input-group label{display:block;font-size:.9rem;color:var(--color-text-muted); transition: color var(--transition-smooth);}
		.input-group input{width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:var(--radius-full);padding:.9rem 1.2rem;color:var(--color-text);font-family:var(--font-body);font-size:1rem;transition: background-color var(--transition-smooth), border-color var(--transition-smooth), color var(--transition-smooth);}
		.input-group input:focus{outline:none;border-color:var(--status-color,var(--color-primary));box-shadow:0 0 0 3px rgba(var(--rgb-status, var(--rgb-primary)), 0.4);transition: border-color var(--transition), box-shadow var(--transition);}
		.input-hint { font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.5rem; text-align: right; transition: color var(--transition-smooth); font-weight: 400; opacity: 0.8; }
		.absence-control, .stepper-control { display:flex; align-items: stretch; background:rgba(0,0,0,0.3); border:1px solid var(--color-border); border-radius:var(--radius-full); overflow:hidden; transition: background-color var(--transition-smooth), border-color var(--transition-smooth); }
		.absence-control input, .stepper-control .stepper-value { flex-grow: 1; border: none !important; border-left: 1px solid var(--color-border); border-right: 1px solid var(--color-border); background: transparent !important; text-align: center; box-shadow: none !important; padding: .9rem .25rem; transition: border-color var(--transition-smooth), color var(--transition-smooth); color: var(--color-text); }
		.stepper-control .stepper-value { font-family: var(--font-title); font-weight: 700; font-size: 1.4rem; padding: 0.3rem 1.2rem; min-width: 50px; user-select: none; }
		.absence-control button, .stepper-control button { position: relative; z-index: 1; background: transparent; border: none; color: var(--color-text); font-size: 1.5rem; cursor: pointer; padding: 0 1.2rem; transition: color var(--transition-smooth), transform .2s ease; line-height: 1; display: flex; align-items: center; user-select: none; }
		.absence-control button:active, .stepper-control button:active { transform:scale(.95); }
		.absence-control input::-webkit-inner-spin-button, .absence-control input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
		.absence-control input{-moz-appearance:textfield}
		.absence-control button::before, .stepper-control button::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: -1; opacity: 0; transition: opacity var(--transition); }
		.absence-control button:hover:not(:disabled), .stepper-control button:hover:not(:disabled) { color: var(--color-primary); transform: scale(1.1); }
		.absence-control button:hover:not(:disabled)::before, .stepper-control button:hover:not(:disabled)::before { opacity: 1; }
		.absence-control button:first-of-type::before, .stepper-control button:first-of-type::before { background: linear-gradient(to left, rgba(var(--rgb-primary), 0.3) 0%, transparent 80%); }
		.absence-control button:last-of-type::before, .stepper-control button:last-of-type::before { background: linear-gradient(to right, rgba(var(--rgb-primary), 0.3) 0%, transparent 80%); }
		.stepper-control button:disabled { opacity: 0.3; cursor: not-allowed; transform: none !important; background: transparent !important; color: var(--color-text-muted) !important; }
		.divider{height:1px;background:var(--color-border);margin:1.5rem 0; transition: background-color var(--transition-smooth);}
		.save-button{width:100%;padding:1rem;font-family:var(--font-body);font-size:1.1rem;font-weight:600;border:none;border-radius:var(--radius-full);cursor:pointer;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));color:#fff;transition:all .2s ease-in-out;display:flex;justify-content:center;align-items:center;gap:.75rem;user-select:none; margin-top: 1.5rem;}
		.save-button svg { font-size: 1.3em; vertical-align: middle; }
		.save-button:hover{transform:translateY(-3px);box-shadow:0 4px 15px rgba(var(--rgb-primary),0.25); filter: brightness(1.1);}
		.save-button:active{transform:translateY(-1px) scale(.98)}
		.view-list-btn { background: rgba(var(--rgb-primary), 0.1); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 0.8rem 1.5rem; color: var(--color-primary); font-family: var(--font-body); font-size: 1rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.75rem; cursor: pointer; transition: background-color var(--transition-smooth), color var(--transition-smooth), border-color var(--transition-smooth), transform var(--transition), box-shadow var(--transition); animation: scaleIn .8s var(--transition-smooth) .3s both; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .view-list-btn:hover { background: rgba(var(--rgb-primary), 0.2); border-color: var(--color-primary); transform: translateY(-2px); }
		.course-list-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid var(--color-border); transition: border-color var(--transition-smooth);}
		.list-controls{display:flex;gap:.75rem;align-items:center}
		.list-controls .control-btn{position:relative;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);color:var(--color-text);border-radius:var(--radius-full);cursor:pointer;transition:var(--transition-smooth);display:flex;align-items:center;font-size:1rem;gap:.5rem;padding:0 .5rem 0 1rem}
		.list-controls .control-btn:hover{border-color:var(--color-primary);color:var(--color-text)}
		.list-controls .control-btn select{color:var(--color-text);background:transparent;border:none;outline:none;padding:.5rem 2rem .5rem .5rem;font-family:var(--font-body);font-size:1rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer; transition: color var(--transition-smooth);}
		.list-controls .control-btn .sort-icon{position:absolute;right:1rem;pointer-events:none}
		
		.course-list{display:flex;flex-direction:column;gap:1rem}
		.course-item{
			display:grid;
			grid-template-columns:1fr auto;
			grid-template-rows:auto auto auto;
			gap:.25rem 1rem;
			padding:1.25rem;
			background:var(--color-card);
			border:1px solid var(--color-border);
			border-radius:var(--radius-md);
			transition: all .4s cubic-bezier(0.2, 0.8, 0.2, 1);
			opacity:0;
			animation:fadeInUp .5s ease both;
			position:relative;
			overflow:hidden;
		}

		.course-item::before {
			content: '';
			position: absolute;
			top: -50%; right: -50%;
			width: 200%; height: 200%;
			background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.15), transparent 40%);
			transition: all .8s cubic-bezier(0.2, 0.8, 0.2, 1);
			transform-origin: top right;
			pointer-events: none;
		}
		
		.course-item:hover {
			transform:translateY(-5px);
			border-color: rgba(var(--rgb-status), 0.25);
			box-shadow: 0 10px 30px rgba(0,0,0,0.2);
		}
		.course-item:hover::before {
			background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.25), transparent 50%);
		}

		.course-item.updated{animation:glow-update 1.5s ease-out,fadeInUp .5s ease both}
		.course-item.safe{--status-color:var(--color-primary); --rgb-status:var(--rgb-primary)}
		.course-item.warning{--status-color:var(--color-warning-gold); --rgb-status:var(--rgb-warning)}
		.course-item.danger{--status-color:var(--color-danger-red); --rgb-status:var(--rgb-danger)}

		.course-info, .course-actions, .course-progress, .course-meta {
			position: relative;
			z-index: 1;
		}

		.course-info h3{font-family:var(--font-title);font-size:1.3rem;font-weight:400;color:#fff; transition: color var(--transition-smooth);}
		.course-info p{color:var(--color-text-muted);font-size:0.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; transition: color var(--transition-smooth);}

		.course-actions{grid-column:2/3;grid-row:1/2;display:flex;gap:.5rem}
		.course-actions button{background:none;border:none;color:var(--color-text-muted);font-size:1.2rem;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;padding:0.25rem}
		.course-actions button:hover{color:#fff;transform:scale(1.1)}
		.course-actions button[title=تعديل]:hover{color:var(--color-primary)}
		.course-actions button[title=حذف]:hover{color:var(--color-danger-red)}

		.course-progress{grid-column:1/3;width:100%;height:6px;background:rgba(255,255,255,0.08);border-radius:3px;margin-top:.5rem; transition: background-color var(--transition-smooth); overflow: hidden;}
		.course-progress-bar{height:100%;background:var(--status-color,var(--color-primary));border-radius:3px;transition: width var(--transition-smooth), background-color var(--transition-smooth)}

		.course-meta{grid-column:1/3;font-size:.8rem;color:var(--color-text-muted);margin-top:.5rem;display:flex;justify-content:space-between;align-items:center}
		.meta-info{display:flex;align-items:center;gap:0.75rem}

		.quick-add-controls { display: flex; gap: 0.5rem; }
		.quick-add-btn { background-color: rgba(255, 255, 255, 0.05); border: 1px solid var(--color-border); color: var(--color-text-muted); font-size: 0.8rem; font-weight: bold; cursor: pointer; border-radius: 8px; padding: 0.2rem 0.6rem; transition: all var(--transition); user-select: none; }
		.quick-add-btn:hover { background-color: rgba(var(--rgb-primary), 0.2); border-color: var(--color-primary); color: var(--color-primary); transform: scale(1.05); }
		.quick-add-btn:active { transform: scale(0.95); }

		.footer{text-align:center;color:var(--color-text-muted);font-size:1rem;display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid var(--color-border);animation:fadeInUp .8s var(--transition-smooth) .8s both; transition: color var(--transition-smooth), border-color var(--transition-smooth);}
		.footer-controls{display:flex;align-items:center;gap:1.2rem}
		.footer-link{color:var(--color-text-muted);transition:var(--transition);display:inline-flex;align-items:center;gap:0.3rem;text-decoration:none}
		.footer-link:hover{color:#fff;transform:scale(1.05)}
		.footer-link svg{font-size:1.5rem}
		.header-icon-btn {background:none;border:none;color:var(--color-text-muted);font-size:1.5rem;cursor:pointer;transition:color var(--transition), transform var(--transition);display:flex;align-items:center;justify-content:center;padding:0.25rem;}
        .header-icon-btn:hover{color:var(--color-primary);transform:scale(1.1)}
		.clear-button:hover{transform:rotate(90deg) scale(1.1)}
		
		/* Custom Picker Component Styles */
        .custom-picker-wrapper { position: relative; cursor: pointer; height: 50px; }
        .custom-picker-display {
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            width:100%; height:100%; background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:var(--radius-full);padding:.9rem 1.2rem;color:var(--color-text);font-family:var(--font-body);font-size:1rem;transition: all var(--transition);
        }
        .custom-picker-display:hover { border-color: var(--color-primary); }
        .custom-picker-wrapper.open .custom-picker-display { opacity: 0; transform: scale(0.95); pointer-events: none; }
        .custom-picker-options-container {
            position: absolute; inset: 0;
            border-radius: var(--radius-full);
            overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
			background: rgba(0,0,0,0.3); border:1px solid var(--color-primary);
			animation: scaleIn 0.2s ease;
        }
		.custom-picker-options-container::before, .custom-picker-options-container::after {
			content: ''; position: absolute; left: 0; right: 0; height: 35%;
			pointer-events: none; z-index: 2;
		}
		.custom-picker-options-container::before { top: 0; background: linear-gradient(to bottom, var(--color-bg-picker, rgba(0,0,0,0.3)), transparent); }
		.custom-picker-options-container::after { bottom: 0; background: linear-gradient(to top, var(--color-bg-picker, rgba(0,0,0,0.3)), transparent); }
		
		.custom-picker-options {
			height: 100%;
			overflow-y: scroll;
			-ms-overflow-style: none; scrollbar-width: none;
			scroll-snap-type: y mandatory;
		}
		.custom-picker-options::-webkit-scrollbar { display: none; }
		.custom-picker-options-list {
			list-style: none;
			padding: 0;
			--item-height: 48px;
			padding-top: calc( (100% / 2) - (var(--item-height) / 2) );
			padding-bottom: calc( (100% / 2) - (var(--item-height) / 2) );
		}
        .custom-picker-option {
            padding: 0.5rem 1rem;
			display: flex; align-items: center; justify-content: center;
			height: var(--item-height);
            transition: color 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
			scroll-snap-align: center;
			opacity: 0.5; transform: scale(0.9);
        }
		.custom-picker-option.is-in-view { opacity: 1; transform: scale(1.05); color: #fff; font-weight: bold; }

		.info-tooltip-wrapper{position:relative;display:flex;align-items:center;color:var(--color-text-muted);cursor:help;margin-right:0.5rem;}
		.info-tooltip-wrapper > svg { color: var(--color-warning-gold); transition: transform 0.2s ease; }
		.info-tooltip-wrapper:hover > svg { transform: scale(1.15) rotate(10deg); }
		.info-tooltip-wrapper .info-tooltip {
			visibility: hidden;
			opacity: 0;
			width: 280px;
			background-color: var(--color-card);
			color: var(--color-text);
			border: 1px solid var(--color-border);
			text-align: right;
			border-radius: var(--radius-md);
			padding: 1rem;
			position: absolute;
			z-index: 10;
			bottom: 125%;
			left: 0;
			transform: none;
			transition: opacity .3s, background-color var(--transition-smooth), border-color var(--transition-smooth), color var(--transition-smooth);
			font-size: 0.85rem;
			line-height: 1.7;
			box-shadow: 0 8px 25px rgba(0,0,0,0.3);
			backdrop-filter: blur(12px);
			-webkit-backdrop-filter: blur(12px);
		}
		.info-tooltip-wrapper .info-tooltip::after {
			content: "";
			position: absolute;
			top: 100%;
			left: 10px;
			margin-left: 0;
			border-width: 6px;
			border-style: solid;
			border-color: var(--color-card) transparent transparent transparent;
			transition: border-color var(--transition-smooth);
		}
		.info-tooltip-wrapper:hover .info-tooltip { visibility:visible; opacity:1; }
		.light-mode .info-tooltip-wrapper .info-tooltip { box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
		
		.result-section{display:flex;align-items:center;gap:1.5rem;margin-top:1.5rem;padding:1.5rem;border-radius:var(--radius);animation:fadeInUp .6s ease both;transition:background .4s ease;background:radial-gradient(circle,rgba(var(--rgb-status,var(--rgb-primary)),0.1) 0%,transparent 70%),rgba(0,0,0,0.2)}
		.chart-container{position:relative;min-width:120px;height:120px}
		.donut-chart{width:100%;height:100%;transform:rotate(-90deg)}
		.donut-chart-bg{fill:none;stroke:var(--color-border);stroke-width:10; transition: stroke var(--transition-smooth);}
		.donut-chart-fg{fill:none;stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset 0.6s cubic-bezier(0.215, 0.61, 0.355, 1), stroke 0.4s ease}
		.donut-chart-fg.safe{stroke:var(--color-primary)}
		.donut-chart-fg.warning{stroke:var(--color-warning-gold)}
		.donut-chart-fg.danger{stroke:var(--color-danger-red)}
		.chart-info{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
		.chart-info span{font-family:var(--font-title);font-weight:700;font-size:2rem;color:#fff;line-height:1.1; transition: color var(--transition-smooth);}
		.chart-info p{font-size:.8rem;color:var(--color-text-muted);margin-top:0.25rem; transition: color var(--transition-smooth);}
		.result-details{flex:1}
		.detail-item{display:flex;justify-content:space-between;align-items:baseline;padding:.5rem 0;font-size:.9rem}
		.detail-item strong{font-size:1.1rem;color:#fff; transition: color var(--transition-smooth);}

		.predictive-text, .denial-message {
			margin-top: 1rem;
			padding: .75rem 1rem;
			border-radius: var(--radius-full);
			font-weight: 600;
			transition: all var(--transition-smooth);
			position: relative;
			overflow: hidden;
			border: 1px solid transparent;
		}
		.predictive-text {
			text-align: center;
			color: var(--status-color, var(--color-text));
			background: rgba(var(--rgb-status, var(--rgb-primary)), 0.1);
			border-color: rgba(var(--rgb-status, var(--rgb-primary)), 0.2);
		}
		.denial-message {
			display: flex;
			align-items: center;
			gap: 1rem;
			background: rgba(var(--rgb-danger), 0.15);
			border-color: rgba(var(--rgb-danger), 0.25);
			padding: 1rem 1.25rem;
		}
		.predictive-text::before {
			content: '';
			position: absolute;
			top: -50%; right: -50%;
			width: 200%; height: 200%;
			background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.15), transparent 40%);
			transition: all .8s cubic-bezier(0.2, 0.8, 0.2, 1);
			transform-origin: top right;
			pointer-events: none;
		}
		.denial-icon{color:var(--color-danger-red);font-size: 2rem;flex-shrink:0;}
		.denial-text-content{flex-grow: 1;}
		.denial-title{font-family:var(--font-title);font-weight:700;color:#fff;font-size:1.2rem;margin:0;line-height:1.2;transition:color var(--transition-smooth);}
		.denial-subtitle{font-size:.9rem;color:var(--color-text-muted);margin-top:.15rem;display: block;transition: color var(--transition-smooth);}

		.empty-list-message{text-align:center;padding:2rem;color:var(--color-text-muted);border:2px dashed var(--color-border);border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;gap:1rem; transition: border-color var(--transition-smooth), color var(--transition-smooth);}
		.empty-list-message svg{font-size:3rem;color:var(--color-primary)}
		
        /* SweetAlert Custom Styles */
        .swal-explanation-content { text-align: right; line-height: 1.8; font-size: 1rem; }
        .swal-explanation-content p { margin: 0 0 1rem 0; }
        .swal-explanation-content h4 { font-family: var(--font-title); font-size: 1.1rem; font-weight: 600; color: var(--color-text); margin-bottom: 0.5rem; }
        .swal-explanation-content .swal-example-box { margin-top: 0.5rem; background: rgba(255,255,255,0.08); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-size: 0.95rem; line-height: 1.7; }
        .swal-explanation-content hr { border: none; height: 1px; background: var(--color-border); margin: 1.5rem 0; }
        .swal-explanation-content .swal-tip { text-align: center; color: var(--color-primary); font-weight: 600; font-size: 0.9rem; margin-top: 1rem; margin-bottom: 0; }
        .light-mode .swal-explanation-content .swal-example-box { background: rgba(0,0,0,0.05); }

		.swal2-popup{background:var(--color-card)!important;color:var(--color-text)!important;border-radius:var(--radius)!important;border:1px solid var(--color-border)!important; transition: background-color var(--transition-smooth), color var(--transition-smooth), border-color var(--transition-smooth); backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);}
		.swal2-title{color:var(--color-text)!important; font-family: var(--font-title) !important; transition: color var(--transition-smooth) !important;}
		.swal2-html-container{color:var(--color-text-muted)!important; transition: color var(--transition-smooth) !important; margin: 1em 0 !important; font-size: 1em !important; display: block !important; }
		.swal2-confirm{background:var(--color-primary)!important;border-radius:var(--radius-full)!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important;transition: background-color var(--transition-smooth) !important;}
		.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(var(--rgb-primary),0.5)!important}
		.swal2-cancel{background:rgba(255,255,255,0.1)!important;color:var(--color-text)!important;border-radius:var(--radius-full)!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important; transition: background-color var(--transition-smooth), color var(--transition-smooth) !important;}
		.swal2-toast { border-radius: 12px !important; border: 1px solid var(--color-border) !important; padding: 1rem !important; transition: background-color var(--transition-smooth), border-color var(--transition-smooth); }
		.swal2-toast .swal2-title { font-size: 1rem !important; }
		.swal2-timer-progress-bar { background: linear-gradient(to right, var(--color-primary), var(--color-primary-dark)); height: 4px !important; }
		.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; animation: fadeIn .3s ease forwards; transition: background-color var(--transition-smooth); }
		.modal-content { background: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 1.5rem; width: 90%; max-width: 500px; z-index: 1001; transform: scale(0.95); opacity: 0; animation: scaleIn .3s .1s ease forwards; position: relative; backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px); transition: background-color var(--transition-smooth), border-color var(--transition-smooth); }
		.modal-close-btn { position: absolute; top: 1rem; left: 1rem; background: none; border: none; color: var(--color-text-muted); font-size: 1.8rem; cursor: pointer; transition: var(--transition); padding: 0.25rem; line-height: 1; }
		.modal-close-btn:hover { color: #fff; transform: rotate(90deg); }
		.modal-header { font-family: var(--font-title); font-size: 1.5rem; color: #fff; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); transition: color var(--transition-smooth), border-color var(--transition-smooth); }
		.settings-content { display: flex; flex-direction: column; gap: 1.5rem; text-align: right; }
		.settings-section { display: flex; flex-direction: column; gap: 1rem; }
		.settings-section-title { font-family: var(--font-title); font-size: 1.2rem; color: var(--color-primary); transition: color var(--transition-smooth); margin-bottom: 0; padding-bottom: 0.5rem; border-bottom: 1px solid var(--color-border); transition: color var(--transition-smooth), border-color var(--transition-smooth); }
		.settings-item { display: flex; justify-content: space-between; align-items: center; }
        .settings-item h4 { font-family: var(--font-body); font-weight: 600; font-size: 1rem; color: var(--color-text); transition: color var(--transition-smooth); }
        .theme-picker{display:flex;gap:.5rem;align-items:center;}
		.theme-dot{width:24px;height:24px;border-radius:50%;cursor:pointer;transition:transform .2s ease, border-color .2s ease;border:2px solid transparent}
		.theme-dot:hover{transform:scale(1.2)}
		.theme-dot.active{border-color:#fff; transform: scale(1.1);}
        .color-picker-label { position: relative; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: all .2s ease; border: 2px solid var(--color-border); user-select: none; overflow: hidden; }
        .color-picker-label:hover { transform: scale(1.2); }
        .color-picker-label.active { border-color: #fff; transform: scale(1.1); }
        .color-picker-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; border: none; padding: 0; cursor: pointer; }
		.data-management-zone { border: 1px solid rgba(var(--rgb-warning), 0.3); border-radius: var(--radius-md); padding: 1rem; background: rgba(var(--rgb-warning), 0.05); transition: border-color var(--transition-smooth), background-color var(--transition-smooth); }
		.data-management-zone .settings-item { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
		.data-management-zone .settings-item-content { text-align: right; width: 100%; }
		.data-management-zone .settings-item-content p { font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.25rem; line-height: 1.5; transition: color var(--transition-smooth); }
		.data-management-zone-btn { align-self: flex-end; margin-top: 0.5rem; background: transparent; color: var(--color-danger-red); border: 1px solid rgba(var(--rgb-danger), 0.5); padding: 0.6rem 1.2rem; border-radius: var(--radius-full); font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: var(--transition); }
		.data-management-zone-btn:hover { background: rgba(var(--rgb-danger), 0.2); color: #fff; border-color: var(--color-danger-red); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(var(--rgb-danger), 0.2); }
		
		.recommendation-message {
			--rgb-status: var(--rgb-primary);
			display: flex;
			align-items: center;
			gap: 0.75rem;
			padding: 0.75rem 1rem;
			border-radius: var(--radius-full);
			margin-top: 1rem;
			font-size: 0.9rem;
			font-weight: 600;
			transition: all 0.3s ease;
			border: 1px solid transparent;
			box-shadow: 0 4px 15px -5px rgba(var(--rgb-status), 0.2);
			white-space: nowrap;
		}
		.recommendation-message.correct {
			--rgb-status: var(--rgb-primary);
			background: rgba(var(--rgb-primary), 0.1);
			border-color: rgba(var(--rgb-primary), 0.2);
			color: var(--color-primary);
		}
		.recommendation-message.warning {
			--rgb-status: var(--rgb-warning);
			background: rgba(var(--rgb-warning), 0.1);
			border-color: rgba(var(--rgb-warning), 0.2);
			color: var(--color-warning-gold);
		}
		.recommendation-message svg {
			font-size: 1.5rem;
			flex-shrink: 0;
		}
		
		.install-app-btn { width: 100%; padding: .8rem; font-family: var(--font-body); font-size: 1.1rem; font-weight: 600; border: none; border-radius: var(--radius-full); cursor: pointer; background: var(--color-save-green); color: #fff; transition: all .2s ease-in-out; display: flex; justify-content: center; align-items: center; gap: .75rem; user-select: none; }
		.install-app-btn:hover { filter: brightness(1.1); transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,200,83,0.3); }
		
		.mode-toggle { display: flex; background: rgba(0,0,0,0.3); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 4px; gap: 4px; transition: var(--transition-smooth); }
		.mode-btn { padding: 0.4rem 1rem; border: none; border-radius: var(--radius-full); font-family: var(--font-body); font-size: 0.9rem; font-weight: 600; cursor: pointer; background: transparent; color: var(--color-text-muted); transition: all 0.2s ease; user-select: none; }
		.mode-btn.active { background: var(--color-primary); color: #fff; box-shadow: 0 2px 5px rgba(var(--rgb-primary), 0.2); }

		.light-mode { --color-bg: #f9f9f9; --color-card: rgba(255, 255, 255, 0.75); --color-border: rgba(0, 0, 0, 0.09); --color-text: #202020; --color-text-muted: #707070; }
		.light-mode .card { box-shadow: 0 16px 40px -12px rgba(0,0,0,0.1); }
		.light-mode .card-header h2, .light-mode .course-info h3, .light-mode .detail-item strong, .light-mode .chart-info span, .light-mode .denial-title, .light-mode .modal-header, .light-mode .settings-item h4, .light-mode .stepper-control .stepper-value { color: var(--color-text); }
		.light-mode .input-group input, .light-mode .custom-picker-display { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--color-text); }
		.light-mode .input-group input:focus, .light-mode .custom-picker-display.open { background-color: rgba(255,255,255,0.5); border-color: var(--color-primary); }
		.light-mode .custom-picker-option:hover { background-color: rgba(0,0,0,0.08); }
        .light-mode .custom-picker-option.is-in-view { color: var(--color-text); }
		.light-mode .custom-picker-options-container { --color-bg-picker: rgba(249,249,249,0.8); }
		.light-mode .absence-control, .light-mode .stepper-control { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }
		.light-mode .absence-control button, .light-mode .stepper-control button { color: var(--color-text-muted); }
		.light-mode .save-button:hover { box-shadow: 0 4px 15px rgba(var(--rgb-primary),0.35); }
		.light-mode .view-list-btn { background: var(--color-card); box-shadow: 0 4px 10px rgba(0,0,0,0.05); color: var(--color-primary); }
		.light-mode .view-list-btn:hover { background: rgba(255,255,255,0.8); border-color: var(--color-primary); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
		.light-mode .list-controls .control-btn { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--color-text-muted); }
		.light-mode .list-controls .control-btn select { color: var(--color-text-muted); }
		.light-mode .list-controls .control-btn:hover { border-color: var(--color-primary); color: var(--color-text); }
		.light-mode .course-item {background: var(--color-card); box-shadow: 0 16px 40px -12px rgba(0,0,0,0.1);}
		.light-mode .course-item::before {background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.1), transparent 50%);}
		.light-mode .course-item:hover::before {background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.18), transparent 60%);}
		.light-mode .course-actions button:hover{ color:var(--color-text); }
		.light-mode .course-progress { background: rgba(0,0,0,0.06); }
		.light-mode .quick-add-btn { background-color: rgba(0,0,0,0.05); color: var(--color-text-muted); }
		.light-mode .quick-add-btn:hover { background-color: rgba(var(--rgb-primary), 0.1); border-color: var(--color-primary); color: var(--color-primary); }
		.light-mode .footer-link:hover { color: var(--color-text); }
		.light-mode .result-section { background: radial-gradient(circle,rgba(var(--rgb-status,var(--rgb-primary)),0.07) 0%,transparent 70%), var(--color-card); }
		.light-mode .predictive-text {background: rgba(var(--rgb-status, var(--rgb-primary)), 0.08);border-color: rgba(var(--rgb-status, var(--rgb-primary)), 0.15);}
		.light-mode .denial-message {background: rgba(var(--rgb-danger), 0.08);border-color: rgba(var(--rgb-danger), 0.15);}
		.light-mode .predictive-text::before {background: radial-gradient(circle at top right, rgba(var(--rgb-status), 0.1), transparent 50%);}
		.light-mode .recommendation-message {box-shadow: 0 4px 20px -5px rgba(var(--rgb-status), 0.3);}
		.light-mode .recommendation-message.correct {background: rgba(var(--rgb-primary), 0.1);border-color: rgba(var(--rgb-primary), 0.2);}
        .light-mode .recommendation-message.warning {background: rgba(var(--rgb-warning), 0.1);border-color: rgba(var(--rgb-warning), 0.2);}
		.light-mode .swal2-popup { box-shadow: 0 10px 50px rgba(0,0,0,0.1) !important;}
		.light-mode .swal2-cancel { background: #f0f0f0 !important; color: var(--color-text) !important; }
		.light-mode .modal-overlay { background-color: rgba(0, 0, 0, 0.15); }
		.light-mode .modal-close-btn:hover { color: var(--color-text); }
		.light-mode .stepper-control button:disabled { color: var(--color-text-muted) !important; }
		.light-mode .data-management-zone { border-color: rgba(var(--rgb-warning), 0.3); background: rgba(var(--rgb-warning), 0.05); }
		.light-mode .mode-toggle { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }

		@media(max-width:600px){
			.app { padding: 1.5rem 1rem; }
			.card { padding: 1.25rem; }
			.title { font-size: 2.2rem; }
			.card-header { padding-bottom: 1rem; margin-bottom: 1rem; }
			.card-header h2 { font-size: 1.5rem; }
			.input-grid { grid-template-columns: 1fr; gap: 1rem; }
			.result-section { flex-direction: column; padding: 1rem; }
			.chart-container { width: 100px; height: 100px; }
			.chart-info span { font-size: 1.6rem; }
			.course-list-header { flex-direction: column; align-items: stretch; }
			.settings-item { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
		}
	</style>
</head>
<body>
	<noscript>You need to enable JavaScript to run this app.</noscript>
    
    <div class="cosmic-bg-container">
        <div class="nebula-glow"></div>
        <canvas id="starfield-canvas"></canvas>
    </div>

	<div id="root"></div>

	<script type="text/babel">
		const { useState, useEffect, useMemo, useCallback, StrictMode, useRef } = React;
		const { createPortal } = ReactDOM;
		
		const SvgIcon = ({ d, viewBox = "0 0 24 24", ...props }) => (
			<svg stroke="currentColor" fill="currentColor" strokeWidth="0" viewBox={viewBox} height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" {...props}>
				<path d={d}></path>
			</svg>
		);

		const Icons = {
			ChevronRight: props => <SvgIcon d="M9 18L15 12 9 6" {...props} />,
			ChevronLeft: props => <SvgIcon d="M15 18L9 12 15 6" {...props} />,
			ChevronDown: props => <SvgIcon d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" {...props} />,
			Plus: props => <SvgIcon d="M12 5V19M5 12H19" {...props} />,
			Close: props => <SvgIcon d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" {...props} />,
			Edit2: props => <SvgIcon d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" {...props} />,
			Trash: props => <SvgIcon d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" {...props} />,
			Telegram: props => <SvgIcon d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 1.62 11.22c-.72-.24-.72-1.16 0-1.41l18.26-6.91c.63-.24 1.22.23 1.01.89L17.43 18.4c-.2 1.39-1.53 1.76-2.53.94l-4.26-3.51-2.86 2.72a.5.5 0 0 1-.88-.38v-4.48z" {...props} />,
			Save: props => <SvgIcon d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zM15 9H5V5h10v4z" {...props} />,
			Lightbulb: props => <SvgIcon d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z" {...props} />,
			Sort: props => <SvgIcon d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z" {...props} />,
			ClipboardList: props => <SvgIcon d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" {...props} />,
			WarningCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" {...props} />,
			HelpCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" {...props} />,
			Settings: props => <SvgIcon d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.44.17-.48.41L9.22 5.25C8.63 5.49 8.1 5.81 7.6 6.19L5.21 5.23c-.22-.08-.47 0-.59.22L2.7 8.77c-.11.2-.06.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23-.41-.12-.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.38 2.44c.04.24.24.41.48.41h3.84c.24 0 .44-.17-.48.41l.38-2.44c.59-.24 1.12-.56 1.62-.94l2.39.96c.22.08.47.02.59-.22l1.92-3.32c.11-.2.06-.47-.12-.61l-2.03-1.58zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" {...props} />,
			CheckCircle: props => <SvgIcon d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" {...props} />,
			Download: props => <SvgIcon d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z" {...props} />,
		};

        const CONSTANTS = { 
			DENIAL_PERCENTAGE: 0.25, 
			MIN_WEEKS: 8, 
			MAX_WEEKS: 20,
			RECOMMENDED_WEEKS: 8,
			RECOMMENDED_SEMESTER_NAME: "465"
		};
		const PRESET_THEMES = {
			blue: '#5e9cff',
			purple: '#a777ff',
			green: '#00e676',
		};

		const SUBTITLES = [
            "راقب غيابك بأسلوب لم تره من قبل",
            "أداة بسيطة وقوية لمتابعة غيابك الدراسي",
            "احسب غيابك بدقة، وبلا تعقيد",
            "أداة ذكية وسلسة لمتابعة الغياب",
            "تابع غيابك، ولا تتركه للصدفة!",
            "سهولة لكل مستخدم، ودقة لكل معلومة",
            "أداة سهلة، سريعة، دقيقة"
        ];

        const Toast = Swal.mixin({
            toast: true, position: 'bottom', showConfirmButton: false, timer: 4000, timerProgressBar: true,
            didOpen: (toast) => { toast.addEventListener('mouseenter', Swal.stopTimer); toast.addEventListener('mouseleave', Swal.resumeTimer); }
        });
		
		const useLocalStorage = (key, defaultValue) => {
			const [value, setValue] = useState(() => {
				try { const saved = localStorage.getItem(key); return saved ? JSON.parse(saved) : defaultValue; }
				catch (error) { return defaultValue; }
			});
			useEffect(() => { localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
			return [value, setValue];
		};

        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
        }

        function adjustColorBrightness(hex, percent) {
            let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            const p = percent / 100;
            r = Math.min(255, Math.max(0, Math.round(r * (1 + p))));
            g = Math.min(255, Math.max(0, Math.round(g * (1 + p))));
            b = Math.min(255, Math.max(0, Math.round(b * (1 + p))));
            return `#${(r).toString(16).padStart(2, '0')}${(g).toString(16).padStart(2, '0')}${(b).toString(16).padStart(2, '0')}`;
        }

		const hexToHue = H => {
			if (!H) return 217;
			let r=0,g=0,b=0;
			if(H.length==7){r="0x"+H[1]+H[2];g="0x"+H[3]+H[4];b="0x"+H[5]+H[6];}
			r/=255;g/=255;b/=255;
			let cmin=Math.min(r,g,b),cmax=Math.max(r,g,b),delta=cmax-cmin,h=0;
			if(delta==0)h=0; else if(cmax==r)h=((g-b)/delta)%6; else if(cmax==g)h=(b-r)/delta+2; else h=(r-g)/delta+4;
			h=Math.round(h*60); if(h<0)h+=360;
			return h;
		};

		const formatHoursText = (hours) => {
			if (hours < 0) hours = 0;
			if (hours === 1) return "ساعة";
			if (hours === 2) return "ساعتين";
			if (hours >= 3 && hours <= 10) return `${hours} ساعات`;
			return `${hours} ساعة`;
		};
		
		function formatArabicPlural(number, forms) {
			if (number === 1) return forms.singular;
			if (number === 2) return forms.dual;
			if (number >= 3 && number <= 10) return `${number} ${forms.paucal}`;
			return `${number} ${forms.plural}`;
		}
		
		function formatRelativeTime(timestamp) {
			const now = new Date(), past = new Date(timestamp), diff = (now - past) / 1000;
			if (diff < 10) return 'الآن';
			if (diff < 60) return `قبل ${formatArabicPlural(Math.round(diff), { singular: 'ثانية', dual: 'ثانيتين', paucal: 'ثوانٍ', plural: 'ثانية' })}`;
			const mins = Math.round(diff / 60);
			if (mins < 60) return `قبل ${formatArabicPlural(mins, { singular: 'دقيقة', dual: 'دقيقتين', paucal: 'دقائق', plural: 'دقيقة' })}`;
			const hours = Math.round(diff / 3600);
			if (hours < 24) return `قبل ${formatArabicPlural(hours, { singular: 'ساعة', dual: 'ساعتين', paucal: 'ساعات', plural: 'ساعة' })}`;
			const days = Math.round(diff / 86400);
			if (days === 1) return "بالأمس";
			return `قبل ${formatArabicPlural(days, { singular: 'يوم', dual: 'يومين', paucal: 'أيام', plural: 'يومًا' })}`;
		}

		function getCourseStatus(course, semesterWeeks) {
            const total = semesterWeeks * course.lectureHours;
            const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
            const denial = allowed + 1;
            const remaining = denial - course.absenceHours;
            const isDenied = course.absenceHours >= denial;
            if (isDenied) return { name: 'danger', remaining, isDenied };
            if (remaining <= 2 && !isDenied) return { name: 'warning', remaining, isDenied };
            return { name: 'safe', remaining, isDenied };
        }
		
		function DonutChart({ percentage, status }) {
			const [animatedPercentage, setAnimatedPercentage] = useState(0);
			useEffect(() => { const animation = requestAnimationFrame(() => setAnimatedPercentage(percentage)); return () => cancelAnimationFrame(animation); }, [percentage]);
			const circumference = 2 * Math.PI * 45, offset = circumference - (animatedPercentage / 100) * circumference;
			return <svg className="donut-chart" viewBox="0 0 100 100"><circle className="donut-chart-bg" cx="50" cy="50" r="45" /><circle className={`donut-chart-fg ${status}`} cx="50" cy="50" r="45" strokeDasharray={circumference} strokeDashoffset={Math.max(0, offset)} /></svg>;
		}

		const CustomPicker = ({ options, value, onChange }) => {
			const [isOpen, setIsOpen] = useState(false);
			const listRef = useRef(null);
			const wrapperRef = useRef(null);
			const selectedOption = options.find(opt => opt.value === value);

			const handleSelect = (optionValue) => {
				onChange(optionValue);
				setIsOpen(false);
			};
			
			const toggleOpen = () => setIsOpen(prev => !prev);
			
			useEffect(() => {
				if (isOpen && listRef.current) {
					const selectedIndex = options.findIndex(opt => opt.value === value);
					if (selectedIndex > -1) {
						listRef.current.scrollTo({
							top: selectedIndex * 48,
							behavior: 'smooth'
						});
					}
				}
			}, [isOpen, value, options]);

			useEffect(() => {
				const handleClickOutside = (event) => {
					if (isOpen && wrapperRef.current && !wrapperRef.current.contains(event.target)) {
						setIsOpen(false);
					}
				};
				document.addEventListener("mousedown", handleClickOutside);
				return () => document.removeEventListener("mousedown", handleClickOutside);
			}, [isOpen]);
			
			useEffect(() => {
				if (!isOpen) return;
				const listEl = listRef.current;
				const observer = new IntersectionObserver(
					(entries) => {
						entries.forEach(entry => {
							entry.target.classList.toggle('is-in-view', entry.isIntersecting);
						});
					}, { root: listEl, threshold: 0.6 }
				);
				
				const children = Array.from(listEl.querySelector('.custom-picker-options-list').children);
				children.forEach(child => observer.observe(child));
				
				return () => children.forEach(child => observer.unobserve(child));
			}, [isOpen]);

			return (
				<div className={`custom-picker-wrapper ${isOpen ? 'open' : ''}`} ref={wrapperRef}>
					<div className="custom-picker-display" onClick={toggleOpen}>
						<span>{selectedOption ? selectedOption.label : '...'}</span>
					</div>
					{isOpen && (
						<div className="custom-picker-options-container">
							<div className="custom-picker-options" ref={listRef}>
								<ul className="custom-picker-options-list">
									{options.map(option => (
										<li
											key={option.value}
											className={`custom-picker-option ${value === option.value ? 'selected' : ''}`}
											onClick={() => handleSelect(option.value)}
										>
											{option.label}
										</li>
									))}
								</ul>
							</div>
						</div>
					)}
				</div>
			);
		};

		const CourseItem = ({ course, onSelect, onDelete, onQuickAdd, style, semesterWeeks, lastUpdatedId }) => {
			const [isUpdated, setIsUpdated] = useState(false);
			useEffect(() => { if (lastUpdatedId === course.id) { setIsUpdated(true); const timer = setTimeout(() => setIsUpdated(false), 1500); return () => clearTimeout(timer); } }, [lastUpdatedId, course.id]);
			
			const { name: status, remaining } = getCourseStatus(course, semesterWeeks);
			const denial = Math.floor((semesterWeeks * course.lectureHours) * CONSTANTS.DENIAL_PERCENTAGE) + 1;
			
			return (
				<div className={`course-item ${status} ${isUpdated ? "updated" : ""}`} style={style}>
					<div className="course-info"><h3>{course.name}</h3><p>ساعات الغياب: {course.absenceHours} | المتبقي للحرمان: {formatHoursText(remaining)}</p></div>
                    <div className="course-actions"><button onClick={() => onSelect(course)} title="تعديل"><Icons.Edit2 /></button><button onClick={() => onDelete(course.id)} title="حذف"><Icons.Trash /></button></div>
					<div className="course-progress"><div className="course-progress-bar" style={{ width: `${Math.min(100, (course.absenceHours / denial) * 100)}%` }}></div></div>
					<div className="course-meta">
                        <div className="meta-info">
							<span>{formatRelativeTime(course.lastUpdated)}</span>
						</div>
                        <div className="quick-add-controls">
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 1)}>+1</button>
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 2)}>+2</button>
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 3)}>+3</button>
                        </div>
                    </div>
				</div>
			);
		};

		function CourseList({ courses, onSelect, onDelete, onQuickAdd, sortOrder, onSortChange, semesterWeeks, lastUpdatedId }) {
			return (
				<div id="course-list-section" className="card" style={{ animationDelay: '.2s' }}>
					<div className="card-header"><h2><Icons.ClipboardList /> قائمة المقررات</h2>
						<div className="list-controls">
							<div className="control-btn">
								<Icons.Sort className="sort-icon" />
								<select value={sortOrder} onChange={e => onSortChange(e.target.value)} title="فرز المقررات">
                                    <option value="urgency">الأكثر حرجًا</option>
                                    <option value="remaining">الأقل تبقيًا</option>
                                    <option value="recent">الأحدث تحديثًا</option>
                                    <option value="alpha">أبجدي</option>
                                </select>
							</div>
						</div>
					</div>
					{courses.length === 0 ? <div className="empty-list-message"><Icons.ClipboardList /><p>قائمتك فارغة. ابدأ بإضافة مقرر جديد!</p></div> : <div className="course-list">{courses.map((course, index) => <CourseItem key={course.id} course={course} onSelect={onSelect} onDelete={onDelete} onQuickAdd={onQuickAdd} semesterWeeks={semesterWeeks} lastUpdatedId={lastUpdatedId} style={{ animationDelay: `${index * 100}ms` }} />)}</div>}
				</div>
			);
		}
		
		const useDoubleClickOnElementToClose = (elementRef, onClose) => {
			useEffect(() => {
				const element = elementRef.current;
				if (!element) return;
				const handleDoubleClick = (e) => {
					if (!e.target.closest('button, input, select, a, .theme-dot, .color-picker-label')) {
						onClose();
					}
				};
				element.addEventListener('dblclick', handleDoubleClick);
				return () => element.removeEventListener('dblclick', handleDoubleClick);
			}, [elementRef, onClose]);
		};

		function SettingsModal({ isOpen, onClose, children }) {
			const modalContentRef = useRef(null);
			useDoubleClickOnElementToClose(modalContentRef, onClose);
			
			useEffect(() => {
				if (isOpen) {
					document.body.classList.add('modal-open');
				} else {
					document.body.classList.remove('modal-open');
				}
				return () => document.body.classList.remove('modal-open');
			}, [isOpen]);
			
			if (!isOpen) return null;

			return createPortal(
				<div className="modal-overlay">
					<div className="modal-content" ref={modalContentRef}>
						<button onClick={onClose} className="modal-close-btn" title="إغلاق"><Icons.Close /></button>
						{children}
					</div>
				</div>,
				document.body
			);
		}

		function AbsenceCalculator({ onSave, selectedCourse, onClear, courses, semesterWeeks }) {
			const [name, setName] = useState("");
			const [lectureHours, setLectureHours] = useState(3);
			const [absenceHours, setAbsenceHours] = useState("");
			
			useEffect(() => {
                setName(selectedCourse?.name || "");
                setLectureHours(selectedCourse?.lectureHours || 3);
                setAbsenceHours(selectedCourse?.absenceHours ?? "");
            }, [selectedCourse]);

			const result = useMemo(() => {
				const absenceNum = parseInt(absenceHours, 10) || 0;
				const total = semesterWeeks * lectureHours;
				const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
				const denial = allowed + 1;
				const percentage = total > 0 ? (absenceNum / total) * 100 : 0;
				const remaining = denial - absenceNum;
				const { name: status, isDenied } = getCourseStatus({ absenceHours: absenceNum, lectureHours }, semesterWeeks);
				
				let predictiveText = "";
				if (!isDenied) {
					if (remaining >= 1) {
						predictiveText = `أنت على بعد ${formatHoursText(remaining)} من الحرمان.`;
					} else {
						predictiveText = "أنت في منطقة الأمان.";
					}
				}
				
				return { percentage, status, predictiveText, allowed, denial, isDenied };
			}, [lectureHours, absenceHours, semesterWeeks]);

			const handleSubmit = (e) => {
				e.preventDefault();
				if (!name && courses.length > 0) {
                    Toast.fire({ icon: 'warning', title: 'الرجاء إدخال اسم المقرر' });
                    return;
                }
                const courseName = name || 'حساب سريع';

				const existingCourse = courses.find(c => c.name.trim().toLowerCase() === courseName.trim().toLowerCase());
				if (existingCourse && (!selectedCourse || selectedCourse.id !== existingCourse.id)) {
					Swal.fire({
						icon: 'warning', title: 'المقرر موجود بالفعل', text: `هل تريد تعديل بيانات مقرر ${existingCourse.name}؟`,
						showCancelButton: true, confirmButtonText: 'نعم، قم بالتعديل', cancelButtonText: 'إلغاء',
						customClass: { popup: 'swal-popup-animation-in' },
						showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' }
					}).then((result) => { if (result.isConfirmed) onClear(existingCourse); });
					return;
				}

				const isUpdating = !!selectedCourse;
				onSave({
					id: selectedCourse ? selectedCourse.id : Date.now(), name: courseName, lectureHours,
					absenceHours: parseInt(absenceHours, 10) || 0, lastUpdated: Date.now()
				});
                if (name) {
                    Toast.fire({ icon: 'success', title: isUpdating ? 'تم تحديث المقرر بنجاح' : 'تمت إضافة المقرر بنجاح', timer: 3000 });
                }
			};

			const changeAbsence = (change) => setAbsenceHours(String(Math.max(0, (parseInt(absenceHours, 10) || 0) + change)));
			
			const showExplanation = () => {
				const explanationHtml = `
				<div class="swal-explanation-content">
					<h4>أولاً: الساعات الأسبوعية</h4>
					<p>الغياب يُحسب على <strong>ساعات الحضور الأسبوعية</strong> للمقرر، وليس على ساعاته المعتمدة في المعدل.</p>
					<p class="swal-example-box"><strong>مثال:</strong> لمقرر محاضرتين بالأسبوع، وكل محاضرة مدتها ساعتان، بالتالي ساعات الحضور الأسبوعية = <strong>4 ساعات</strong>.</p>
					<hr/>
					<h4>ثانياً: معادلة الحرمان</h4>
					<p>يتم الحرمان عند تجاوز نسبة الغياب <strong style="color: var(--color-danger-red);">25%</strong> من مجموع الساعات الدراسية الفعلية للمقرر.</p>
					<hr/>
					<h4>ثالثاً: تحديد عدد الأسابيع</h4>
					<p>يتم حساب الغياب على أساس عدد الأسابيع الفعلية للدراسة، ويمكنك ضبط هذا العدد من الإعدادات ⚙️.</p>
					<p class="swal-example-box"><strong>مثال:</strong> فصل دراسي مدته 20 أسبوعاً، لكن بعد استثناء الإجازات والاختبارات، تكون الأسابيع الفعلية للحساب هي <strong style="color: var(--color-primary);">17 أسبوعاً</strong>.</p>
					<p class="swal-tip">✨ نصيحة: لإغلاق هذه النافذة بسرعة، المسها مرتين!</p>
				</div>`;

				Swal.fire({
					title: 'كيف يتم حساب الغياب؟',
                    html: explanationHtml,
                    showCloseButton: true,
                    showConfirmButton: false,
                    customClass: { popup: 'swal-popup-animation-in' },
                    showClass: { popup: '' },
                    hideClass: { popup: 'swal-popup-animation-out' },
					willOpen: () => { document.body.classList.add('modal-open'); },
					didOpen: (popup) => {
						popup.addEventListener('dblclick', (e) => {
							if (!e.target.closest('button, input, select, a, strong')) {
								Swal.close();
							}
						});
					},
					willClose: () => { document.body.classList.remove('modal-open'); }
				});
			};
			
			const lectureOptions = [...Array(12).keys()].map(i => ({ value: i + 1, label: formatHoursText(i + 1) }));

			return (
				<form id="main-calculator-card" className={`card ${result?.status}`} onSubmit={handleSubmit}>
					<div className="card-header">
                        <h2>{selectedCourse ? <><Icons.Edit2 /> تعديل المقرر</> : <><Icons.Plus /> إضافة مقرر جديد</>}</h2>
						<div className="card-header-controls">
							<button type="button" className="header-icon-btn" onClick={showExplanation} title="شرح طريقة الحساب"><Icons.HelpCircle /></button>
							{selectedCourse && <button type="button" className="header-icon-btn clear-button" onClick={() => onClear(null)} title="إلغاء التعديل"><Icons.Plus /></button>}
						</div>
                    </div>
					<div className="input-grid">
						<div className="input-group">
							<label>اسم المقرر</label>
							<input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="مثال: فيزياء 101" />
							{!selectedCourse && <p className="input-hint">للحساب السريع، اترك اسم المقرر فارغًا.</p>}
						</div>
						<div className="input-group">
							<div className="label-with-info">
								<label>الساعات الأسبوعية</label>
								<div className="info-tooltip-wrapper"><Icons.Lightbulb /><span className="info-tooltip">الغياب يُحسب على ساعات الحضور الأسبوعية للمقرر، وليس على ساعاته المعتمدة في المعدل.<br/><br/>فمثلًا: لمقرر محاضرتين بالأسبوع، وكل محاضرة مدتها ساعتان، بالتالي ساعات الحضور الأسبوعية<br/>= 4 ساعات.</span></div>
							</div>
							<CustomPicker options={lectureOptions} value={lectureHours} onChange={setLectureHours} />
						</div>
						<div className="input-group"><label>ساعات الغياب الحالية</label>
							<div className="absence-control">
								<button type="button" onClick={() => changeAbsence(1)}><Icons.ChevronRight /></button>
								<input type="number" value={absenceHours} onChange={e => setAbsenceHours(String(e.target.value))} placeholder="0" min="0" />
								<button type="button" onClick={() => changeAbsence(-1)}><Icons.ChevronLeft /></button>
							</div>
						</div>
					</div>
					
					{result && absenceHours !== "" && (<>
						<div className="divider"></div>
						<div className="result-section">
							<div className="chart-container"><DonutChart percentage={result.percentage} status={result.status} /><div className="chart-info"><span>{Math.min(result.percentage, 100).toFixed(1)}%</span><p>نسبة الغياب</p></div></div>
							<div className="result-details">
								<div className="detail-item"><span>الغياب المسموح</span><strong>{formatHoursText(result.allowed)}</strong></div>
								<div className="detail-item"><span>بداية الحرمان</span><strong>{formatHoursText(result.denial)}</strong></div>
								{result.isDenied ? (
									<div className="denial-message">
										<Icons.WarningCircle className="denial-icon" />
										<div className="denial-text-content">
											<p className="denial-title">حرمان</p>
											<span className="denial-subtitle">لقد تجاوزت الحد الأقصى للغياب.</span>
										</div>
									</div>
								) : (<div className="predictive-text">{result.predictiveText}</div>)}
							</div>
						</div>
					</>)}
					<button type="submit" className="save-button">{selectedCourse ? <><Icons.Save /> تحديث المقرر</> : <><Icons.Save /> إضافة مقرر</>}</button>
				</form>
			);
		}
		
		function App() {
			const [courses, setCourses] = useLocalStorage("courses", []);
			const [selectedCourse, setSelectedCourse] = useState(null);
			const [sortOrder, setSortOrder] = useState('urgency');
			const [theme, setTheme] = useLocalStorage('theme', PRESET_THEMES.blue);
			const [semesterWeeks, setSemesterWeeks] = useLocalStorage('semesterWeeks', CONSTANTS.RECOMMENDED_WEEKS);
			const [lastUpdatedId, setLastUpdatedId] = useState(null);
			const [isSettingsOpen, setIsSettingsOpen] = useState(false);
			const [subtitle, setSubtitle] = useState(SUBTITLES[0]);
			const [colorMode, setColorMode] = useLocalStorage('colorMode', 'dark');
			const [installPrompt, setInstallPrompt] = useState(null);

			useEffect(() => {
                const primaryColor = theme;
                const darkColor = adjustColorBrightness(primaryColor, -20);
                const rgbColor = hexToRgb(primaryColor);
				const primaryHue = hexToHue(primaryColor);
    			const secondaryHue = (primaryHue + 40) % 360;

                document.documentElement.style.setProperty('--color-primary', primaryColor);
                document.documentElement.style.setProperty('--color-primary-dark', darkColor);
                if (rgbColor) { document.documentElement.style.setProperty('--rgb-primary', rgbColor); }
				document.documentElement.style.setProperty('--primary-hue', String(primaryHue));
                document.documentElement.style.setProperty('--secondary-hue', String(secondaryHue));
			}, [theme]);
			
			useEffect(() => {
				document.body.className = colorMode === 'light' ? 'light-mode' : '';
				const themeColorMeta = document.querySelector('meta[name="theme-color"]');
				if (themeColorMeta) { themeColorMeta.setAttribute('content', colorMode === 'light' ? '#f9f9f9' : '#0a0a0a'); }
			}, [colorMode]);
			
			useEffect(() => {
				const handler = e => { e.preventDefault(); setInstallPrompt(e); };
				window.addEventListener('beforeinstallprompt', handler);
				return () => window.removeEventListener('beforeinstallprompt', handler);
			}, []);

			useEffect(() => {
				const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
                document.documentElement.style.setProperty('--scrollbar-width', `${scrollbarWidth}px`);

				const randomIndex = Math.floor(Math.random() * SUBTITLES.length);
            	setSubtitle(SUBTITLES[randomIndex]);
				if ('serviceWorker' in navigator) {
					const swCode = `const CACHE_NAME = 'absence-calculator-cache-v44'; self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.add('.')))); self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));`;
					try { const blob = new Blob([swCode], { type: 'application/javascript' }); navigator.serviceWorker.register(URL.createObjectURL(blob)); } 
                    catch(e) { console.error("Could not register service worker.", e); }
				}
			}, []);

			const handleInstallClick = useCallback(async () => {
				if (!installPrompt) return;
				const result = await installPrompt.prompt();
				if (result.outcome === 'accepted') { Toast.fire({ icon: 'success', title: 'تم تثبيت التطبيق بنجاح!' }); }
				setInstallPrompt(null);
			}, [installPrompt]);

			const handleAddOrUpdate = (course) => {
				const isNewUnnamed = !course.name || course.name === 'حساب سريع';
				if (isNewUnnamed && !selectedCourse) { setSelectedCourse(null); return; }
				
				const index = courses.findIndex(c => c.id === course.id);
				const updatedCourses = [...courses];
				if (index > -1) { updatedCourses[index] = course; } 
                else { updatedCourses.push(course); }
				setCourses(updatedCourses); setLastUpdatedId(course.id); setSelectedCourse(null);
			};

            const handleQuickAdd = useCallback((id, amount) => {
                let updatedCourse = null;
                const updatedCourses = courses.map(c => {
                    if (c.id === id) {
                        updatedCourse = { ...c, absenceHours: c.absenceHours + amount, lastUpdated: Date.now() };
                        return updatedCourse;
                    }
                    return c;
                });

                setCourses(updatedCourses);
                setLastUpdatedId(id);

                if (selectedCourse && selectedCourse.id === id && updatedCourse) {
                    setSelectedCourse(updatedCourse);
                }

                if (!updatedCourse) return;
                const { name: status, remaining, isDenied } = getCourseStatus(updatedCourse, semesterWeeks);
                let toastOptions = { icon: 'success', title: `تم تحديث غياب مقرر ${updatedCourse.name} بنجاح`, timer: 3000 };
                if (isDenied) {
                    toastOptions = { icon: 'error', title: `لقد وصلت إلى الحرمان في مقرر ${updatedCourse.name}!` };
                } else if (status === 'warning') {
                    const remainingText = formatHoursText(remaining);
                    toastOptions = { icon: 'warning', title: `تحذير: غياب ${remainingText} أخرى سيؤدي للحرمان من مقرر ${updatedCourse.name}` };
                }
                Toast.fire(toastOptions);
            }, [courses, setCourses, semesterWeeks, selectedCourse]);

			const handleDelete = (id) => {
				Swal.fire({
					title: 'هل أنت متأكد؟', text: "لن تتمكن من استرجاع هذا المقرر!", icon: 'warning', showCancelButton: true, 
                    confirmButtonColor: 'var(--color-primary)', cancelButtonColor: 'var(--color-danger-red)',
					confirmButtonText: 'نعم، احذفه!', cancelButtonText: 'إلغاء',
					customClass: { popup: 'swal-popup-animation-in' },
					showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' },
					willOpen: () => { document.body.classList.add('modal-open'); },
                    willClose: () => { document.body.classList.remove('modal-open'); }
				}).then((result) => {
					if (result.isConfirmed) {
						setCourses(courses.filter(c => c.id !== id)); 
						if (selectedCourse && selectedCourse.id === id) setSelectedCourse(null);
                        Toast.fire({ icon: 'success', title: 'تم حذف المقرر', timer: 3000 });
					}
				})
			};

            const handleResetAll = () => {
				setIsSettingsOpen(false);
				setTimeout(() => {
					Swal.fire({
						title: 'هل أنت متأكد من مسح البيانات؟', text: "سيتم حذف جميع المقررات المحفوظة بشكل نهائي للبدء من جديد.", icon: 'warning',
						showCancelButton: true, confirmButtonColor: 'var(--color-danger-red)', cancelButtonColor: 'var(--color-border)',
						confirmButtonText: 'نعم، متأكد!', cancelButtonText: 'إلغاء',
						customClass: { popup: 'swal-popup-animation-in' },
						showClass: { popup: '' }, hideClass: { popup: 'swal-popup-animation-out' },
						willOpen: () => { document.body.classList.add('modal-open'); },
						willClose: () => { document.body.classList.remove('modal-open'); }
					}).then((result) => {
						if (result.isConfirmed) {
							setCourses([]); setSelectedCourse(null);
							Toast.fire({ icon: 'success', title: 'تم مسح جميع البيانات بنجاح', timer: 3000 });
						}
					})
				}, 300);
            };

			const handleSelect = (course) => { setSelectedCourse(course); window.scrollTo({ top: 0, behavior: "smooth" }); };
			const handleClear = (courseToSelect = null) => { setSelectedCourse(courseToSelect); if(courseToSelect) { window.scrollTo({ top: 0, behavior: "smooth" }); } };
			
			const handleScrollToList = () => {
                const listElement = document.getElementById('course-list-section');
                if (listElement) { listElement.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
            };

			const sortedCourses = useMemo(() => {
				return [...courses].filter(c => c.name !== 'حساب سريع').sort((a, b) => {
                    const statusA = getCourseStatus(a, semesterWeeks);
                    const statusB = getCourseStatus(b, semesterWeeks);
                    switch (sortOrder) {
                        case 'recent': return b.lastUpdated - a.lastUpdated;
                        case 'alpha': return a.name.localeCompare(b.name, 'ar');
                        case 'remaining': return statusA.remaining - statusB.remaining;
                        case 'urgency': default:
                            const totalA = semesterWeeks * a.lectureHours, totalB = semesterWeeks * b.lectureHours;
                            const percentageA = totalA > 0 ? (a.absenceHours / totalA) : 0;
                            const percentageB = totalB > 0 ? (b.absenceHours / totalB) : 0;
                            return percentageB - percentageA;
                    }
                });
			}, [courses, sortOrder, semesterWeeks]);

            const isCustomTheme = !Object.values(PRESET_THEMES).includes(theme);
			const visibleCourses = sortedCourses.filter(c => c.name && c.name !== 'حساب سريع');

			return (
				<div className="app">
					<div className="container">
						<header className="header">
							<h1 className="title">حاسبة الغياب</h1>
							<p className="subtitle">{subtitle}</p>
						</header>

						{visibleCourses.length > 0 && (
							<button className="view-list-btn" onClick={handleScrollToList}>
								<Icons.ClipboardList />
								<span>عرض قائمة المقررات</span>
							</button>
						)}

						<AbsenceCalculator 
							key={selectedCourse ? selectedCourse.id : "new"} 
							onSave={handleAddOrUpdate} selectedCourse={selectedCourse} onClear={handleClear} courses={courses}
                            semesterWeeks={semesterWeeks}
						/>
						{visibleCourses.length > 0 && <CourseList courses={visibleCourses} onSelect={handleSelect} onDelete={handleDelete} onQuickAdd={handleQuickAdd} sortOrder={sortOrder} onSortChange={setSortOrder} semesterWeeks={semesterWeeks} lastUpdatedId={lastUpdatedId} />}
						
						<SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)}>
							<h2 className="modal-header">الإعدادات</h2>
							<div className="settings-content">
								
								<div className="settings-section">
									<h3 className="settings-section-title">إعدادات الفصل</h3>
									<div className="settings-item">
										<h4>عدد أسابيع الفصل</h4>
										<div className="stepper-control">
											<button type="button" onClick={() => setSemesterWeeks(p => Math.min(CONSTANTS.MAX_WEEKS, p + 1))} disabled={semesterWeeks >= CONSTANTS.MAX_WEEKS}><Icons.ChevronRight /></button>
											<span className="stepper-value">{semesterWeeks}</span>
											<button type="button" onClick={() => setSemesterWeeks(p => Math.max(CONSTANTS.MIN_WEEKS, p - 1))} disabled={semesterWeeks <= CONSTANTS.MIN_WEEKS}><Icons.ChevronLeft /></button>
										</div>
									</div>
									{semesterWeeks === CONSTANTS.RECOMMENDED_WEEKS ? (
										<div className="recommendation-message correct">
											<Icons.CheckCircle />
											<span>هذا هو العدد المتوقع للصيفي {CONSTANTS.RECOMMENDED_SEMESTER_NAME}</span>
										</div>
									) : (
										<div className="recommendation-message warning">
											<Icons.WarningCircle />
											<span>العدد الموصى به هو {CONSTANTS.RECOMMENDED_WEEKS} أسابيع.</span>
										</div>
									)}
								</div>

								<div className="settings-section">
									<h3 className="settings-section-title">مظهر التطبيق</h3>
									<div className="settings-item">
										<h4>الوضع</h4>
										<div className="mode-toggle">
											<button className={`mode-btn ${colorMode === 'dark' ? 'active' : ''}`} onClick={() => setColorMode('dark')}>ظلام</button>
											<button className={`mode-btn ${colorMode === 'light' ? 'active' : ''}`} onClick={() => setColorMode('light')}>نهار</button>
										</div>
									</div>
									<div className="settings-item">
										<h4>اختر السمة</h4>
										<div className="theme-picker">
											{Object.entries(PRESET_THEMES).map(([name, color]) => (
												<div key={name} className={`theme-dot ${theme === color ? 'active' : ''}`} style={{ backgroundColor: color }} onClick={() => setTheme(color)} />
											))}
											<label htmlFor="custom-color-picker-modal" className={`color-picker-label ${isCustomTheme ? 'active' : ''}`} title="اختر لونًا مخصصًا" style={{ backgroundColor: isCustomTheme ? theme : 'transparent' }}>
												<input id="custom-color-picker-modal" type="color" className="color-picker-input" value={theme} onChange={(e) => setTheme(e.target.value)} />
											</label>
										</div>
									</div>
								</div>

								<div className="settings-section data-management-zone">
									<h3 className="settings-section-title" style={{color: 'var(--color-warning-gold)', borderBottomColor: 'rgba(var(--rgb-warning), 0.3)'}}>إدارة البيانات</h3>
									<div className="settings-item">
										<div className="settings-item-content">
											<h4>بدء فصل دراسي جديد</h4>
											<p>هذا الإجراء سيقوم بحذف جميع المقررات المحفوظة بشكل نهائي.</p>
										</div>
										<button onClick={handleResetAll} className="data-management-zone-btn">مسح والبدء من جديد</button>
									</div>
								</div>
							</div>
						</SettingsModal>

						<footer className="footer">
							<span className="footer-link">© 2025 | ظلام</span>
							<div className="footer-controls">
								{installPrompt && (
									<button onClick={handleInstallClick} className="header-icon-btn" title="تثبيت التطبيق">
										<Icons.Download />
									</button>
								)}
								<button onClick={() => setIsSettingsOpen(true)} className="header-icon-btn" title="الإعدادات">
									<Icons.Settings />
								</button>
								<a href="https://t.me/mutlaq1" className="footer-link" target="_blank" rel="noopener noreferrer" title="تواصل معي على تليجرام"><Icons.Telegram /></a>
							</div>
						</footer>
					</div>
				</div>
			);
		}
		
		const root = ReactDOM.createRoot(document.getElementById("root"));
		root.render(<StrictMode><App /></StrictMode>);
	</script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const initCosmicEffects = () => {
            const canvas = document.getElementById('starfield-canvas'); if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let stars = [], shootingStars = [], scrollSpeed = 0, lastScrollY = window.scrollY;
            let mouseX = 0, mouseY = 0;

            function resizeCanvas() { 
                canvas.width = window.innerWidth; 
                canvas.height = window.innerHeight; 
            }

            window.addEventListener('mousemove', e => {
                mouseX = e.clientX - canvas.width / 2;
                mouseY = e.clientY - canvas.height / 2;
            });
            
            class Star { 
                constructor() {
                    this.depth = Math.random() * 0.9 + 0.1; // 0.1 (far) to 1.0 (near)
                    this.reset();
                    this.pulsate = Math.random() > 0.98;
                    this.alpha = 0;
                    this.alphaChange = (Math.random() * 0.02) + 0.005;
                }
                reset() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.radius = (Math.random() * 1.2 + 0.3) * this.depth;
                    this.maxAlpha = (Math.random() * 0.5 + 0.3) * this.depth;
                }
                draw() {
                    const parallaxX = (mouseX / (canvas.width / 2)) * -25 * this.depth;
                    const parallaxY = (mouseY / (canvas.height / 2)) * -25 * this.depth;

                    if (this.pulsate) { 
                        this.alpha += this.alphaChange; 
                        if (this.alpha >= this.maxAlpha || this.alpha <= 0) this.alphaChange *= -1; 
                    } else { 
                        this.alpha = this.maxAlpha; 
                    }
                    ctx.globalAlpha = this.alpha;
                    ctx.beginPath();
                    ctx.arc(this.x + parallaxX, this.y + parallaxY, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(220, 80%, 95%)`;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
                update() {
                    this.y += scrollSpeed * this.depth; 
                    
                    if (this.y > canvas.height + this.radius) this.y = -this.radius;
                    if (this.y < -this.radius) this.y = canvas.height + this.radius;

                    this.draw();
                }
            }

            class ShootingStar { constructor() { this.reset(); } reset() { this.x = Math.random() * canvas.width; this.y = 0; this.len = Math.random() * 80 + 10; this.speed = Math.random() * 10 + 6; this.size = Math.random() * 1 + 0.1; this.waitTime = new Date().getTime() + Math.random() * 3000 + 500; this.active = false; } update() { if (this.active) { this.x -= this.speed; this.y += this.speed; if (this.x < 0 || this.y >= canvas.height) this.reset(); } else if (this.waitTime < new Date().getTime()) this.active = true; } draw() { if (this.active) { ctx.strokeStyle = `hsla(220, 100%, 80%, ${Math.random() * 0.5 + 0.5})`; ctx.lineWidth = this.size; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.len, this.y - this.len); ctx.stroke(); } } }
            
            function initStars() { 
                stars = []; 
                shootingStars = []; 
                const starCount = Math.floor(canvas.width * canvas.height / 8000); 
                for (let i = 0; i < starCount; i++) { stars.push(new Star()); } 
                for (let i = 0; i < 3; i++) { shootingStars.push(new ShootingStar()); } 
            }

            function animate() { 
                requestAnimationFrame(animate); 
                ctx.clearRect(0, 0, canvas.width, canvas.height); 
                stars.forEach(s => s.update()); 
                shootingStars.forEach(s => { s.update(); s.draw(); }); 
                scrollSpeed *= 0.9; 
            }

            window.addEventListener('scroll', () => { 
                const delta = window.scrollY - lastScrollY; 
                scrollSpeed += delta * 0.03;
                lastScrollY = window.scrollY; 
            });

            window.addEventListener('resize', () => { 
                resizeCanvas(); 
                initStars(); 
            });
            
            const initCardTilt = () => {
                const card = document.getElementById('main-calculator-card');
                if (card) {
                    card.addEventListener('mousemove', (e) => { 
                        const rect = card.getBoundingClientRect(); 
                        const x = e.clientX - rect.left; 
                        const y = e.clientY - rect.top; 
                        const { width, height } = rect; 
                        const rX = ((y / height) - 0.5) * -15; 
                        const rY = ((x / width) - 0.5) * 15; 
                        card.style.transform = `rotateX(${rX}deg) rotateY(${rY}deg)`; 
                        card.style.setProperty('--mouse-x', `${(x / width) * 100}%`); 
                        card.style.setProperty('--mouse-y', `${(y / height) * 100}%`); 
                    });
                    card.addEventListener('mouseleave', () => { card.style.transform = 'rotateX(0) rotateY(0)'; });
                }
            };
            
            setTimeout(initCardTilt, 500);

            resizeCanvas(); 
            initStars(); 
            animate();
        };

        initCosmicEffects();
    });
    </script>
</body>
</html>