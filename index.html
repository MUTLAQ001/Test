<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="theme-color" content="#0a0a0a">
	<title>GE 211 - 472</title>
	
	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

	<style>
		@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700;900&display=swap");
		@import url("https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap");

		:root{
            --bg-dark: #050505;
            --color-concept: #ffd700;
            --color-lab: #00f2ff;
            --color-record: #ff3e4d;
            --color-holiday: #ff4757;
            --color-success: #00e676;
            --font-body: "Cairo", sans-serif;
            --font-nums: "Outfit", sans-serif;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }
		
        * {margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color: transparent;}
		html{scroll-behavior:smooth;scrollbar-width:none;}
		::-webkit-scrollbar {display: none;}
        
        @keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }
        @keyframes pulse-border { 0% {border-color: rgba(255,255,255,0.2);} 50% {border-color: rgba(255,255,255,0.8);} 100% {border-color: rgba(255,255,255,0.2);} }

		body{
            font-family:var(--font-body);
            background-color:var(--bg-dark);
            color:#fff;
            direction:rtl;
            overflow-x:hidden;
        }
		
        .cosmic-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;background: radial-gradient(circle at 50% 10%, #1a1a2e 0%, #000 100%);}
        .stars {position:absolute;width:100%;height:100%;background-image: radial-gradient(white 1px, transparent 1px); background-size: 50px 50px; opacity: 0.1;}
		
        .app{min-height:100vh;position:relative;padding:20px 15px;}
		.container{width:100%;max-width:700px;margin:0 auto;}
		
        .header{text-align:center; margin-bottom: 30px; animation: fadeIn 0.8s ease; position: relative;}
		.title{
            font-family: var(--font-nums);
            font-weight:700; font-size:3rem; margin:0;
            background: linear-gradient(to right, #fff, #aaa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }
		.subtitle{color:#888; font-size:1rem; margin-top: -5px;}

        .team-settings-btn {
            position: absolute; top: 10px; left: 0;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: #fff; border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: var(--transition);
            z-index: 10;
        }
        .team-settings-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

        .author-link {
            position: absolute; top: 10px; right: 0;
            text-decoration: none;
            color: #888; 
            font-size: 0.8rem; font-weight: 700;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            transition: var(--transition);
            display: flex; align-items: center; gap: 5px;
            z-index: 10;
        }
        .author-link:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tabs { 
            background: rgba(255,255,255,0.05); 
            padding: 5px; border-radius: 15px; 
            display: flex; justify-content: space-between;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tab-btn {
            flex: 1; text-align: center; padding: 12px;
            background: transparent; border: none; color: #888;
            font-family: var(--font-body); font-weight: 700; cursor: pointer;
            border-radius: 12px; transition: var(--transition);
        }
        .tab-btn.active { 
            background: rgba(255,255,255,0.1); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .sub-nav-wrapper {
            background: rgba(255,255,255,0.03);
            border-radius: 14px;
            padding: 4px;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .sub-nav-glider {
            position: absolute;
            top: 4px; bottom: 4px;
            width: calc(33.33% - 5px);
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 10px;
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .sub-nav-wrapper[data-active="0"] .sub-nav-glider { border-color: rgba(255, 215, 0, 0.3); box-shadow: 0 0 20px rgba(255, 215, 0, 0.1); }
        .sub-nav-wrapper[data-active="1"] .sub-nav-glider { border-color: rgba(0, 242, 255, 0.3); box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); }
        .sub-nav-wrapper[data-active="2"] .sub-nav-glider { border-color: rgba(255, 62, 77, 0.3); box-shadow: 0 0 20px rgba(255, 62, 77, 0.1); }

        .sub-tab-item {
            position: relative; z-index: 2; background: transparent; border: none; padding: 10px;
            font-family: var(--font-body); font-weight: 700; color: #666; cursor: pointer;
            transition: color 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .sub-tab-item.active { color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .sub-tab-item svg { font-size: 1.1rem; margin-bottom: -2px; }

        .content-area { animation: fadeIn 0.4s ease-out; }
        
        .pro-resource-card {
            display: flex; flex-direction: column; padding: 20px; margin-bottom: 15px;
            background: linear-gradient(145deg, rgba(30,30,35,0.6), rgba(20,20,25,0.8));
            border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; transition: var(--transition);
            backdrop-filter: blur(10px); position: relative; overflow: hidden;
        }
        .pro-resource-card:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.15); }

        .resource-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .resource-icon-box { 
            width: 45px; height: 45px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        }
        .type-files .resource-icon-box { color: var(--color-lab); }
        .type-quizzes .resource-icon-box { color: var(--color-concept); }
        .type-recordings .resource-icon-box { color: var(--color-record); }
        .resource-info h3 { margin: 0; font-size: 1.1rem; font-weight: 700; color: #fff; }
        .resource-info p { margin: 3px 0 0; font-size: 0.85rem; color: #888; }
        
        .resource-links { display: flex; gap: 10px; flex-wrap: wrap; }
        .res-link-btn {
            flex: 1; text-align: center; padding: 12px; font-size: 0.9rem;
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            color: #ccc; border-radius: 10px; text-decoration: none; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 140px;
        }
        .res-link-btn:hover { background: rgba(255,255,255,0.1); color: #fff; transform: translateY(-2px); }
        .res-link-btn.primary { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }

        .audio-wrapper-styled {
            width: 100%;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 5px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drive-player-frame {
            border: none;
            width: 100%;
            height: 100px;
            border-radius: 8px;
            /* Invert filter makes Google's white player look dark-mode compliant */
            filter: invert(0.92) hue-rotate(180deg) contrast(0.9);
            mix-blend-mode: screen;
        }
        
        .fallback-link {
            font-size: 0.8rem;
            color: #666;
            text-decoration: none;
            text-align: center;
            display: block;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .fallback-link:hover { text-decoration: underline; color: var(--color-record); }

        .empty-state-box {
            text-align: center; padding: 60px 20px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
            border: 1px dashed rgba(255,255,255,0.1); border-radius: 20px;
            margin-top: 10px; animation: fadeIn 0.5s ease;
        }
        .empty-icon { font-size: 3rem; margin-bottom: 15px; opacity: 0.3; display: block; margin-left: auto; margin-right: auto;}
        .empty-title { font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 5px; }
        .empty-desc { color: #666; font-size: 0.9rem; }

        .timeline-container { padding-bottom: 50px; }
        
        .session-card {
            display: flex; align-items: stretch;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05);
            background: rgba(30,30,35,0.6);
            animation: fadeIn 0.5s ease both;
            cursor: pointer;
            flex-wrap: wrap;
        }
        
        .session-card.current-day {
            border: 2px solid rgba(255,255,255,0.5);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            animation: pulse-border 2s infinite;
        }
        
        .session-card.is-past {
            opacity: 0.6;
            filter: grayscale(0.9);
            border-color: #222;
        }
        .session-card.is-past .session-topic {
            text-decoration: line-through;
            color: #666;
        }
        .session-card.is-past:hover {
            opacity: 1; filter: grayscale(0);
        }

        .past-badge {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.6); color: #aaa; font-size: 0.7rem; padding: 3px 10px;
            border-radius: 10px; font-weight: bold; border: 1px solid #333;
            display: flex; align-items: center; gap: 4px; z-index: 2;
        }

        .session-card.concept { border-color: rgba(255, 215, 0, 0.4); background: linear-gradient(145deg, rgba(255, 215, 0, 0.05) 0%, rgba(20, 20, 25, 0.8) 100%); }
        .session-card.lab { border-color: rgba(0, 242, 255, 0.4); background: linear-gradient(145deg, rgba(0, 242, 255, 0.05) 0%, rgba(20, 20, 25, 0.8) 100%); }
        .session-card.holiday { border-color: rgba(255, 71, 87, 0.4); background: linear-gradient(145deg, rgba(255, 71, 87, 0.05) 0%, rgba(20, 20, 25, 0.8) 100%); pointer-events: none; }

        .session-card:hover { transform: translateY(-3px) scale(1.01); box-shadow: 0 12px 40px rgba(0,0,0,0.5); }
        
        .date-box {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 15px; min-width: 85px;
            background: rgba(0,0,0,0.2);
            border-left: 1px solid rgba(255,255,255,0.05);
        }
        .date-day-name { font-size: 0.8rem; color: #aaa; margin-bottom: 2px; }
        .date-day-num { font-family: var(--font-nums); font-size: 1.8rem; font-weight: 700; color: #fff; line-height: 1; }
        .date-month { font-family: var(--font-nums); font-size: 0.8rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        .card-content { flex: 1; padding: 15px; display: flex; flex-direction: column; justify-content: center; position: relative; }
        .session-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        
        .session-id { 
            font-family: var(--font-nums); font-size: 1.3rem; font-weight: 700; 
            display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px;
        }
        .session-card.concept .session-id { color: var(--color-concept); text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .session-card.lab .session-id { color: var(--color-lab); text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
        
        .session-topic { font-size: 1rem; color: #eee; font-weight: 500; line-height: 1.4; transition: var(--transition); direction: ltr; text-align: right; }
        
        .due-tag {
            align-self: flex-start; margin-top: 10px; font-size: 0.8rem; padding: 5px 12px;
            border-radius: 20px; background: rgba(255, 71, 87, 0.15); color: #ff6b81; border: 1px solid rgba(255, 71, 87, 0.3);
            display: flex; align-items: center; gap: 6px; font-weight: 600; width: fit-content;
        }

        .external-file-btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            margin-bottom: 25px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
            animation: fadeIn 0.5s ease both;
        }
        .external-file-btn.concept { color: var(--color-concept); border-color: rgba(255, 215, 0, 0.2); }
        .external-file-btn.lab { color: var(--color-lab); border-color: rgba(0, 242, 255, 0.2); }

        .external-file-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }

        .block-divider {
            height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            margin: 25px 0; width: 70%; margin-left: auto; margin-right: auto;
        }

        .completed-block-card {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255, 255, 255, 0.03);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 15px 20px;
            border-radius: 16px;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        .completed-block-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        .block-info { display: flex; align-items: center; gap: 12px; font-weight: 700; color: #aaa; }
        .block-status { font-size: 0.8rem; color: #666; display: flex; align-items: center; gap: 5px; }

        .calc-container { padding: 5px; }
        .calc-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 600px) { .calc-grid { grid-template-columns: 1fr 1fr; } }
        .calc-section-title { margin-bottom: 10px; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .calc-section { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .input-row label { font-size: 0.9rem; color: #ccc; flex: 1; margin-left: 10px; line-height: 1.3; }
        .counter-control { display: flex; align-items: center; gap: 5px; background: #000; padding: 4px; border-radius: 10px; border: 1px solid #333; flex-shrink: 0; }
        .counter-btn { width: 32px; height: 32px; border: none; background: #222; color: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .counter-btn:active { background: #444; }
        .counter-val { width: 30px; text-align: center; font-family: var(--font-nums); font-size: 1.1rem; }

        .grade-result { text-align: center; padding: 30px; margin-top: 20px; background: radial-gradient(circle, rgba(94, 156, 255, 0.1) 0%, transparent 70%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; }
        .grade-big { font-size: 4rem; font-family: var(--font-nums); font-weight: 800; text-shadow: 0 0 30px currentColor; }
        .grade-A { color: #00c853; } .grade-B { color: #2979ff; } .grade-C { color: #ffd600; } .grade-D { color: #ff6d00; } .grade-F { color: #ff1744; }
        .defects-text { font-size: 0.9rem; color: #888; margin-top: 5px; }
        .reset-btn { background: transparent; border: 1px solid rgba(255,71,87,0.3); color: #ff6b81; padding: 8px 15px; border-radius: 8px; margin-top: 15px; cursor: pointer; font-size: 0.8rem; }

        .missed-btn { width: 100%; display: flex; justify-content: center; align-items: center; padding: 18px; margin-top: 25px; border-radius: 16px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); transition: all 0.3s; text-align: center; }
        .missed-btn:active { transform: scale(0.98); }
        .missed-btn.active { background: rgba(255, 71, 87, 0.15); border-color: #ff4757; box-shadow: 0 0 20px rgba(255, 71, 87, 0.2); animation: pulse-border 2s infinite; }
        .missed-info { display: flex; flex-direction: column; align-items: center; }
        .missed-title { font-weight: 700; font-size: 1rem; color: #ccc; transition: 0.3s; }
        .missed-sub { font-size: 0.8rem; color: #666; margin-top: 3px; }
        .missed-btn.active .missed-title { color: #ff4757; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 1000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: #121215; width: 100%; max-width: 400px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); padding: 30px; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.6); animation: fadeIn 0.3s ease; }
        .modal-title { text-align: center; font-size: 1.3rem; margin-bottom: 25px; font-weight: 800; color: #fff; }
        .modal-close { position: absolute; top: 15px; left: 15px; background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; }
        
        .role-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 8px; }
        .role-label { font-weight: 700; color: var(--color-lab); display: flex; align-items: center; gap: 8px; }
        .role-value { font-family: var(--font-body); color: #fff; }

        .desc-box { background: linear-gradient(145deg, #1e1e24, #121215); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 24px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .desc-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 12px; }
        .desc-title { color: #fff; font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 1rem; }
        .desc-content { color: #ddd; line-height: 1.6; font-size: 0.95rem; font-family: 'Outfit', sans-serif; direction: ltr; text-align: left; }
        .desc-content.rtl { direction: rtl; text-align: right; font-family: var(--font-body); }
        
        .lang-switch { display: flex; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 3px; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; position: relative; width: 70px; height: 28px; }
        .lang-option { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; color: #888; z-index: 2; transition: 0.3s; }
        .lang-active-bg { position: absolute; top: 3px; left: 3px; width: 32px; height: 20px; background: var(--color-lab); border-radius: 15px; z-index: 1; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .lang-switch.active .lang-active-bg { transform: translateX(32px); }
        .lang-switch.active .lang-option:last-child { color: #000; }
        .lang-switch:not(.active) .lang-option:first-child { color: #000; }
        
        .timer-toggle-btn { width: 100%; padding: 15px; margin-bottom: 25px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; color: #fff; font-family: var(--font-body); font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; }
        .timer-toggle-btn.active { background: rgba(0, 230, 118, 0.15); border-color: #00e676; color: #00e676; box-shadow: 0 0 15px rgba(0, 230, 118, 0.2); }
        .timer-toggle-btn:hover { transform: translateY(-2px); }
        .timer-status-text { font-size: 0.9rem; }

        .team-member-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; background: rgba(255,255,255,0.03); padding: 8px 15px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; }
        .team-member-row:focus-within { border-color: var(--color-lab); background: rgba(0, 242, 255, 0.05); }
        .member-icon { color: #666; font-size: 1.1rem; }
        .team-input-clean { background: transparent; border: none; color: #fff; width: 100%; outline: none; font-family: var(--font-body); font-size: 0.95rem; padding: 5px 0; }
        .team-input-clean::placeholder { color: #444; }
        
        .save-btn-new { width: 100%; padding: 16px; background: linear-gradient(90deg, var(--color-lab), #00d2ff); color: #000; font-weight: 800; font-size: 1rem; border: none; border-radius: 14px; margin-top: 20px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .save-btn-new:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 242, 255, 0.2); }

	</style>
</head>
<body>
    <div class="cosmic-bg"><div class="stars"></div></div>
	<div id="root"></div>

	<script type="text/babel">
		const { useState, useEffect, useMemo, StrictMode } = React;

        const Icons = {
            Concept: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>,
            Lab: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 2v7.31"></path><path d="M14 2v7.31"></path><path d="M8.5 2h7"></path><path d="M14 9.3a6.5 6.5 0 1 1-4 0"></path></svg>,
            Holiday: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>,
            Alert: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            Folder: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>,
            File: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>,
            Check: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Users: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
            Star: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
            Clock: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Edit: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            Info: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>,
            User: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            ChevronDown: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            ChevronUp: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"></polyline></svg>,
            Video: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>,
            Mic: () => <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
        };

        const fileResources = {
            'C1': 'https://quedusa-my.sharepoint.com/:f:/g/personal/aahmad_qu_edu_sa/IgBsZMm8IgCRTqhDX_ANa2pmAckD8u73ILSfXhTbOFK5WPE?e=ZCzoK2',
            'C2': 'https://quedusa-my.sharepoint.com/:f:/g/personal/aahmad_qu_edu_sa/IgDn7UcbYTPtRpkJNVFch1yeAT37pqOezgtg554yCLiHyLM?e=pIf5yU',
            'L1': 'https://quedusa-my.sharepoint.com/:f:/g/personal/aahmad_qu_edu_sa/IgDL-fpADYWmSaQESGlldC7WAZc9DHkFJus3G_DSoGF5J88?e=lwgE7y',
            'FDM': 'https://quedusa-my.sharepoint.com/:f:/g/personal/aahmad_qu_edu_sa/IgCEkYAUr-F-TLUsEgwkrnb0AeUxpPv7XtflM9LuOicGtzA?e=acJxqo'
        };

        const ContentView = () => {
            const [activeIdx, setActiveIdx] = useState(1); 

            const tabs = [
                { id: 'quizzes', label: 'الكويزات', icon: <Icons.Edit/> },
                { id: 'files', label: 'الملفات', icon: <Icons.File/> },
                { id: 'recordings', label: 'التسجيلات', icon: <Icons.Mic/> }
            ];

            const files = [
                { 
                    title: 'First Day Material (FDM)', 
                    type: 'folder',
                    links: [
                        { name: 'فتح المجلد', url: fileResources['FDM'] }
                    ]
                },
                { 
                    title: 'C1 Concept Session', 
                    type: 'mixed',
                    links: [
                        { name: 'ملفات الجلسة', url: fileResources['C1'] },
                        { name: 'تسليم ورقي (Hard Copy)', url: 'https://quedusa-my.sharepoint.com/:f:/g/personal/aahmad_qu_edu_sa/IgA3a2WpU-uXTrOKBYRswqBeAWfVih3Z_XzIqH0UBUO0Y4M?e=lnLaDi', isImportant: true }
                    ]
                },
                { 
                    title: 'C2 Concept Session', 
                    type: 'folder',
                    links: [
                        { name: 'فتح المجلد', url: fileResources['C2'] }
                    ]
                },
                { 
                    title: 'L1 Lab Session', 
                    type: 'folder',
                    links: [
                        { name: 'فتح المجلد', url: fileResources['L1'] }
                    ]
                },
            ];

            const recordings = [
                {
                    title: 'C1 Concept Session',
                    id: '1w7VRYalrK7mQH8FkmlBsHBTmHXtRSe2r'
                }
            ];

            const renderContent = () => {
                const typeMap = {0: 'quizzes', 1: 'files', 2: 'recordings'};
                const currentType = typeMap[activeIdx];

                if (currentType === 'files') {
                    return (
                        <div className="content-area">
                            {files.map((f, i) => (
                                <div key={i} className={`pro-resource-card type-files`} style={{animationDelay: `${i * 0.1}s`}}>
                                    <div className="resource-header">
                                        <div className="resource-icon-box">
                                            <Icons.Folder />
                                        </div>
                                        <div className="resource-info">
                                            <h3>{f.title}</h3>
                                        </div>
                                    </div>
                                    <div className="resource-links">
                                        {f.links.map((link, idx) => (
                                            <a key={idx} href={link.url} target="_blank" className={`res-link-btn ${link.isImportant ? 'primary' : ''}`}>
                                                {link.isImportant ? <Icons.Star/> : <Icons.File/>} {link.name}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    );
                }

                if (currentType === 'recordings') {
                    if (recordings.length > 0) {
                        return (
                            <div className="content-area">
                                {recordings.map((rec, i) => (
                                    <div key={i} className="pro-resource-card type-recordings" style={{animationDelay: `${i * 0.1}s`}}>
                                        <div className="resource-header">
                                            <div className="resource-icon-box">
                                                <Icons.Mic />
                                            </div>
                                            <div className="resource-info">
                                                <h3>{rec.title}</h3>
                                            </div>
                                        </div>
                                        <div className="audio-wrapper-styled">
                                            <iframe 
                                                className="drive-player-frame"
                                                src={`https://drive.google.com/file/d/${rec.id}/preview`} 
                                                allow="autoplay"
                                            ></iframe>
                                            <a href={`https://drive.google.com/file/d/${rec.id}/view`} target="_blank" className="fallback-link">
                                                اضغط هنا للفتح في Google Drive
                                            </a>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        );
                    }
                }

                const emptyData = {
                    'quizzes': { icon: <Icons.Edit/>, title: 'الكويزات غير متاحة', desc: 'سيتم إضافة الكويزات التدريبية قريباً' },
                    'recordings': { icon: <Icons.Mic/>, title: 'لا توجد تسجيلات', desc: 'لم يتم رفع أي تسجيلات صوتية لهذه المادة بعد' }
                };
                const info = emptyData[currentType];

                return (
                    <div className="content-area">
                         <div className="empty-state-box">
                            <div className="empty-icon">{info.icon}</div>
                            <div className="empty-title">{info.title}</div>
                            <div className="empty-desc">{info.desc}</div>
                        </div>
                    </div>
                );
            };

            return (
                <div>
                    <div className="sub-nav-wrapper" data-active={activeIdx}>
                        <div className="sub-nav-glider" style={{ transform: `translateX(${-activeIdx * 100}%)` }}></div>
                        {tabs.map((t, i) => (
                            <button 
                                key={t.id} 
                                className={`sub-tab-item ${activeIdx === i ? 'active' : ''}`} 
                                onClick={() => setActiveIdx(i)}
                            >
                                {t.icon} <span>{t.label}</span>
                            </button>
                        ))}
                    </div>

                    {renderContent()}
                </div>
            )
        };

        const ScheduleView = ({ openTeamSettings, teamMembers, settings }) => {
            const startDate = new Date('2026-01-22');
            
            const holidays = [{ start: '2026-03-22', end: '2026-03-26', name: "إجازة عيد الفطر" }];
            
            const sessionDetails = {
                'C2-1': { 
                    title: {en: 'Quiz #1', ar: 'كويز 1'},
                    desc: {
                        en: 'Quiz #1: First Day materials (white, orange, yellow packets) + Blue Workbook (J49-J56) - Various Levels of Learning.',
                        ar: 'كويز 1: مواد اليوم الأول (الرزم البيضاء، البرتقالية، الصفراء) + كتاب العمل الأزرق (J49-J56).'
                    } 
                },
                'C2-2': {
                    title: {en: 'Submit C1', ar: 'تسليم C1'},
                    desc: {
                        en: 'Assignment C1 Due: Engineering the Profession.',
                        ar: 'تسليم واجب C1: مهنة الهندسة.'
                    }
                },
                'C2-3': { 
                    title: {en: 'Quiz #2', ar: 'كويز 2'},
                    desc: {
                        en: 'Quiz #2: SCPS Chapter 1 (Pages 1-3) + Blue Workbook Sections B (B5-B10) and E (E1-E12).',
                        ar: 'كويز 2: الفصل 1 من كتاب SCPS (ص 1-3) + الأقسام B و E من كتاب العمل الأزرق.'
                    } 
                },
                'C3-1': { 
                    title: {en: 'Quiz #3', ar: 'كويز 3'},
                    desc: {
                        en: 'Quiz #3: SCPS Chapter 2 (Sections 2.3, 2.5 on Page 12) + Chapter 3 (Page 29 to end of 3.2C).',
                        ar: 'كويز 3: الفصل 2 (أقسام محددة) + الفصل 3 (من ص 29 إلى نهاية 3.2C) من SCPS.'
                    } 
                },
                'C3-3': { 
                    title: {en: 'Quiz #4', ar: 'كويز 4'},
                    desc: {
                        en: 'Quiz #4: SCPS Chapter 4 (Page 61 to end of Sec 4.3B).',
                        ar: 'كويز 4: الفصل 4 من صفحة 61 حتى نهاية القسم 4.3B في كتاب SCPS.'
                    } 
                },
                'C4-1': { 
                    title: {en: 'Quiz #5', ar: 'كويز 5'},
                    desc: {
                        en: 'Quiz #5: More about problem definition: SCPS Chapter 3 (from 3.2D to end of chapter).',
                        ar: 'كويز 5: تعريف المشكلة: الفصل 3 (من 3.2D للنهاية) في SCPS.'
                    } 
                },
                'C4-3': { 
                    title: {en: 'Quiz #6', ar: 'كويز 6'},
                    desc: {
                        en: 'Quiz #6: SCPS Chapter 5 until end of Page 102.',
                        ar: 'كويز 6: الفصل 5 حتى نهاية الصفحة 102 في كتاب SCPS.'
                    } 
                },
                'C5-1': { 
                    title: {en: 'Quiz #7', ar: 'كويز 7'},
                    desc: {
                        en: 'Quiz #7: SCPS Chapter 5 (Page 103 to end) + Exxon Valdez problem (handouts).',
                        ar: 'كويز 7: الفصل 5 (من ص 103 للنهاية) + مشكلة Exxon Valdez.'
                    } 
                },
                'C5-3': { 
                    title: {en: 'Quiz #8', ar: 'كويز 8'},
                    desc: {
                        en: 'Quiz #8: SCPS Chapter 6 until end of section 6.4.',
                        ar: 'كويز 8: الفصل 6 حتى نهاية القسم 6.4 من الفصل 6 في كتاب SCPS.'
                    } 
                },
                'C6-1': { 
                    title: {en: 'Quiz #9', ar: 'كويز 9'},
                    desc: {
                        en: 'Quiz #9: SCPS Chapter 6 (from section 6.5 to end).',
                        ar: 'كويز 9: الفصل 6 من القسم 6.5 حتى نهاية الفصل 6 في SCPS.'
                    } 
                },
                'C6-2': {
                    title: {en: 'Makeup Q6+Q7', ar: 'إعادة كويز 6+7'},
                    desc: {
                        en: 'Correction/Makeup for Quiz 6 and Quiz 7.',
                        ar: 'فرصة إعادة أو تصحيح للكويز رقم 6 و 7.'
                    }
                },
                'C6-3': { 
                    title: {en: 'Quiz #10', ar: 'كويز 10'},
                    desc: {
                        en: 'Quiz #10: All of SCPS Chapter 7.',
                        ar: 'كويز 10: كامل الفصل 7 في كتاب SCPS.'
                    } 
                },
                'L1-3': {
                    title: {en: 'Teammate Interview', ar: 'مقابلة الزملاء'},
                    desc: {
                        en: 'Submission: L-1 Teammate Interview (Hard copy).',
                        ar: 'تسليم L-1 Teammate Interview (ورقي بالكامل).'
                    }
                },
                'L2-1': {
                    title: {en: 'L2 Draft', ar: 'مسودة L2'},
                    desc: {
                        en: 'L-2 Setting Team Norms (Step 1) - Draft only.',
                        ar: 'تسليم L-2 Setting Team Norms (Step 1) - مسودة فقط.'
                    }
                },
                'L2-2': {
                    title: {en: 'L5 Checks', ar: 'فحص L5'},
                    desc: {
                        en: 'L-5 Team Process Checks (Checklist + forms).',
                        ar: 'L-5 Team Process Checks (Checklist + forms).'
                    }
                },
                'L2-3': { 
                    title: {en: 'Zeroth Notebook', ar: 'دفتر Zeroth'}, 
                    desc: {
                        en: 'Submission: L-3-0th Team’s Design Notebook (Zeroth) (Hard copy).',
                        ar: 'تسليم L-3-0th Team’s Design Notebook (Zeroth) (ورقي بالكامل).'
                    } 
                },
                'L3-1': { 
                    title: {en: 'Submit L1+L2 | Makeup Q1', ar: 'تسليم L1+L2 | إعادة Q1'}, 
                    desc: {
                        en: 'Final submission for L-1 & L-2. Makeup Quiz 1 in first 10 mins.',
                        ar: 'تسليم نهائي لـ L-1 و L-2. إعادة كويز 1 في أول 10 دقائق.'
                    } 
                },
                'L3-2': { 
                    title: {en: 'Makeup Q2', ar: 'إعادة Q2'}, 
                    desc: {
                        en: 'Makeup Quiz 2 in first 10 mins.',
                        ar: 'إعادة كويز 2 في أول 10 دقائق.'
                    } 
                },
                'L4-1': { 
                    title: {en: 'L4-a + L2 Final', ar: 'L4-a + L2 تسليم'}, 
                    desc: {
                        en: 'Presentation of Project Phase (a) + DNB 1st assessment. L-2 Final Submission.',
                        ar: 'عرض تقديمي للمشروع L-4-a + التقييم الأول لدفتر التصميم (DNB). تسليم نهائي لـ L-2.'
                    } 
                },
                'L4-2': { 
                    title: {en: 'Submit L4-b | Makeup Q3', ar: 'تسليم L4-b | إعادة Q3'}, 
                    desc: {
                        en: 'Presentation of Project Phase (b) + DNB 2nd assessment. Makeup Quiz 3 in first 10 mins.',
                        ar: 'عرض تقديمي للمشروع L-4-b + التقييم الثاني لدفتر التصميم. إعادة كويز 3 in first 10 mins.'
                    } 
                },
                'L4-3': { 
                    title: {en: 'Makeup Q4', ar: 'إعادة Q4'}, 
                    desc: {
                        en: 'Makeup Quiz 4 in first 10 mins.',
                        ar: 'إعادة كويز 4 في أول 10 دقائق.'
                    } 
                },
                'L5-2': { 
                    title: {en: 'Submit L4-c | Makeup Q5', ar: 'تسليم L4-c | إعادة Q5'}, 
                    desc: {
                        en: 'Presentation of Project Phase (c) + DNB 3rd assessment. Makeup Quiz 5 in first 10 mins.',
                        ar: 'عرض تقديمي للمشروع L-4-c + التقييم الثالث لدفتر التصميم. إعادة كويز 5 في أول 10 دقائق.'
                    } 
                },
                'L5-3': { 
                    title: {en: 'Final Checks', ar: 'فحص نهائي'}, 
                    desc: {
                        en: 'Submission: L-4-d (Presentation) + DNB 4th Assessment.',
                        ar: 'تسليم L-4-d (عرض تقديمي) + التقييم الرابع لدفتر التصميم.'
                    } 
                },
                'L6-1': { 
                    title: {en: 'Submit L4-d | Makeup Q8', ar: 'تسليم L4-d | إعادة Q8'}, 
                    desc: {
                        en: 'Submission: L-4-e (Presentation) + DNB 5th Assessment. Makeup Quiz 8 in first 10 mins.',
                        ar: 'تسليم L-4-e (عرض تقديمي) + التقييم الخامس لدفتر التصميم. إعادة كويز 8 في أول 10 دقائق.'
                    } 
                },
                'L6-2': { 
                    title: {en: 'Makeup Q9', ar: 'إعادة Q9'}, 
                    desc: {
                        en: 'Makeup Quiz 9.',
                        ar: 'إعادة كويز 9.'
                    } 
                },
                'L6-3': { 
                    title: {en: 'Submit L4-e | Makeup Q10', ar: 'تسليم L4-e | إعادة Q10'}, 
                    desc: {
                        en: 'Final Submission: L-3-final (Celebration) + DNB. Makeup Quiz 10.',
                        ar: 'تسليم نهائي للمشروع L-3-final (Celebration) وملفات الدفتر. إعادة كويز 10.'
                    } 
                }
            };

            const [selectedSession, setSelectedSession] = useState(null);
            const [transMode, setTransMode] = useState(false);
            const [expandedBlocks, setExpandedBlocks] = useState({});

            const sessions = useMemo(() => {
                let list = [], curr = new Date(startDate), type='concept', count=0, cycles={concept:1, lab:1};
                let safety=0, sessionIndex = 0;
                while(cycles.concept <= 10 && safety < 150) {
                    let d = curr.getDay();
                    if(d===0 || d===2 || d===4) {
                        let dateStr = curr.toISOString().split('T')[0];
                        let isHol = holidays.find(h => dateStr >= h.start && dateStr <= h.end);
                        if(isHol) {
                            list.push({type:'holiday', date:new Date(curr), id:'OFF', topic:isHol.name});
                        } else {
                            if (cycles[type] > 6) break;

                            let pre = type==='concept'?'C':'L';
                            let id = `${pre}${cycles[type]}-${count+1}`;
                            let isStart = (count===0);
                            
                            let details = sessionDetails[id] || {};
                            
                            list.push({
                                type, date:new Date(curr), id, 
                                topic: '',
                                due: details.title, 
                                fullDesc: details.desc,
                                isBlockStart: isStart,
                                index: sessionIndex 
                            });
                            sessionIndex++;
                            count++;
                            if(count>=3) { cycles[type]++; count=0; type = type==='concept'?'lab':'concept'; }
                        }
                    }
                    curr.setDate(curr.getDate()+1); safety++;
                }
                return list;
            }, []);

            const getDayName = (d) => d.toLocaleDateString('en-US', {weekday:'short'});
            const getMonth = (d) => d.toLocaleDateString('en-US', {month:'short'});

            const getRoles = (idx) => {
                if (idx === undefined) return null;
                const leaderIdx = idx % 5;
                const timerIdx = (idx + 1) % 5;
                const writerIdx = (idx + 2) % 5;
                return {
                    Leader: teamMembers[leaderIdx],
                    Timer: teamMembers[timerIdx],
                    Writer: teamMembers[writerIdx]
                };
            };

            const openDetails = (s) => {
                if(s.type === 'holiday') return;
                setTransMode(false);
                setSelectedSession({...s, roles: getRoles(s.index)});
            };

            const getFileUrl = (id) => {
                if (!id) return null;
                const prefix = id.split('-')[0];
                return fileResources[prefix] || null;
            };
            
            const handleCloseModal = () => setSelectedSession(null);

            const toggleBlock = (prefix) => {
                setExpandedBlocks(prev => ({...prev, [prefix]: !prev[prefix]}));
            };

            const today = new Date();
            today.setHours(0,0,0,0);

            const groups = useMemo(() => {
                let g = {};
                let order = [];
                sessions.forEach(s => {
                    let prefix = s.type === 'holiday' ? `HOL-${s.date.getTime()}` : s.id.split('-')[0];
                    if(!g[prefix]) {
                        g[prefix] = [];
                        order.push(prefix);
                    }
                    g[prefix].push(s);
                });
                return { data: g, keys: order };
            }, [sessions]);

            return (
                <div className="timeline-container">
                    {groups.keys.map((prefix, groupIndex) => {
                        const blockSessions = groups.data[prefix];
                        const isHoliday = prefix.startsWith('HOL');
                        
                        if (isHoliday) {
                            const s = blockSessions[0];
                            return (
                                <div key={prefix} className="session-card holiday">
                                    <div className="date-box">
                                        <span className="date-day-name">{getDayName(s.date)}</span>
                                        <span className="date-day-num">{s.date.getDate()}</span>
                                        <span className="date-month">{getMonth(s.date)}</span>
                                    </div>
                                    <div className="card-content">
                                        <div className="session-header">
                                            <div className="session-id"><Icons.Holiday/> <span style={{margin:'0 8px'}}>OFF</span></div>
                                        </div>
                                        <div className="session-topic">{s.topic}</div>
                                    </div>
                                </div>
                            );
                        }

                        const isAllPast = blockSessions.every(s => {
                            let d = new Date(s.date); d.setHours(0,0,0,0);
                            return d.getTime() < today.getTime();
                        });

                        const isExpanded = expandedBlocks[prefix];

                        if (isAllPast && !isExpanded) {
                            return (
                                <React.Fragment key={prefix}>
                                    {groupIndex > 0 && <div className="block-divider"></div>}
                                    <div className="completed-block-card" onClick={() => toggleBlock(prefix)}>
                                        <div className="block-info">
                                            <Icons.Folder /> <span>تم الانتهاء من {prefix}</span>
                                        </div>
                                        <div className="block-status">
                                            عرض التفاصيل <Icons.ChevronDown/>
                                        </div>
                                    </div>
                                </React.Fragment>
                            );
                        }

                        return (
                            <React.Fragment key={prefix}>
                                {groupIndex > 0 && <div className="block-divider"></div>}
                                
                                {isAllPast && isExpanded && (
                                    <div className="completed-block-card" onClick={() => toggleBlock(prefix)} style={{marginBottom:'15px', background:'rgba(255,255,255,0.08)'}}>
                                        <div className="block-info" style={{color:'#fff'}}>
                                            <Icons.Folder /> <span>أرشيف {prefix}</span>
                                        </div>
                                        <div className="block-status" style={{color:'#fff'}}>
                                            إخفاء <Icons.ChevronUp/>
                                        </div>
                                    </div>
                                )}

                                {blockSessions.map((s, i) => {
                                    const sDate = new Date(s.date); sDate.setHours(0,0,0,0);
                                    const isToday = sDate.getTime() === today.getTime();
                                    const isPast = sDate.getTime() < today.getTime();
                                    
                                    const dueTitle = s.due ? s.due['en'] : '';
                                    
                                    return (
                                        <div 
                                            key={i}
                                            className={`session-card ${s.type} ${isToday ? 'current-day' : ''} ${isPast ? 'is-past' : ''}`} 
                                            style={{animationDelay: `${i * 0.05}s`}}
                                            onClick={() => openDetails(s)} 
                                        >
                                            {isPast && <div className="past-badge"><Icons.Check/> منتهية</div>}
                                            <div className="date-box">
                                                <span className="date-day-name">{getDayName(s.date)}</span>
                                                <span className="date-day-num">{s.date.getDate()}</span>
                                                <span className="date-month">{getMonth(s.date)}</span>
                                            </div>
                                            <div className="card-content">
                                                <div className="session-header">
                                                    <div className="session-id">
                                                        {s.type==='concept' && <Icons.Concept />}
                                                        {s.type==='lab' && <Icons.Lab />}
                                                        <span style={{margin:'0 8px'}}>{s.id}</span>
                                                    </div>
                                                </div>
                                                {dueTitle && <div className="due-tag"><Icons.Alert/> {dueTitle}</div>}
                                            </div>
                                        </div>
                                    );
                                })}

                                {getFileUrl(blockSessions[0].id) && (
                                    <a 
                                        href={getFileUrl(blockSessions[0].id)} 
                                        target="_blank" 
                                        className={`external-file-btn ${blockSessions[0].type}`}
                                    >
                                        <Icons.Folder /> <span>فتح ملفات {prefix}</span>
                                    </a>
                                )}
                            </React.Fragment>
                        );
                    })}

                    {selectedSession && (
                        <div className="modal-overlay" onClick={handleCloseModal}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <button className="modal-close" onClick={handleCloseModal}>×</button>
                                <h2 className="modal-title">{selectedSession.id} - تفاصيل الجلسة</h2>
                                
                                <div style={{marginBottom:'20px'}}>
                                    <h3 style={{fontSize:'0.9rem', color:'#888', marginBottom:'10px'}}>أدوار الفريق لهذه الجلسة:</h3>
                                    <div className="role-row">
                                        <span className="role-label"><Icons.Star/> Leader</span>
                                        <span className="role-value">{selectedSession.roles.Leader}</span>
                                    </div>
                                    {settings.timer && (
                                        <div className="role-row">
                                            <span className="role-label"><Icons.Clock/> Timer</span>
                                            <span className="role-value">{selectedSession.roles.Timer}</span>
                                        </div>
                                    )}
                                    <div className="role-row">
                                        <span className="role-label"><Icons.Edit/> Writer</span>
                                        <span className="role-value">{selectedSession.roles.Writer}</span>
                                    </div>
                                </div>

                                {selectedSession.fullDesc && (
                                    <div className="desc-box">
                                        <div className="desc-header">
                                            <div className="desc-title">
                                                <Icons.Info/>
                                                {transMode ? "تفاصيل المهمة / الكويز" : "Task / Quiz Details"}
                                            </div>
                                            <div className={`lang-switch ${transMode ? 'active' : ''}`} onClick={() => setTransMode(!transMode)}>
                                                <div className="lang-active-bg"></div>
                                                <div className="lang-option">EN</div>
                                                <div className="lang-option">AR</div>
                                            </div>
                                        </div>
                                        <div className={`desc-content ${transMode ? 'rtl' : ''}`}>
                                            {selectedSession.fullDesc[transMode ? 'ar' : 'en']}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Counter = ({ label, val, onChange }) => (
            <div className="input-row">
                <label>{label}</label>
                <div className="counter-control">
                    <button className="counter-btn" onClick={() => onChange(Math.max(0, val-1))}>-</button>
                    <div className="counter-val">{val}</div>
                    <button className="counter-btn" onClick={() => onChange(val+1)}>+</button>
                </div>
            </div>
        );

        const GradeView = () => {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem('ge211_data');
                return saved ? JSON.parse(saved) : {
                    cE: 0, cNI: 0, cNCE: 0, cLapses: 0,
                    lE: 0, lNI: 0, lNCE: 0, lLapses: 0,
                    missed: false
                };
            });

            useEffect(() => { localStorage.setItem('ge211_data', JSON.stringify(state)); }, [state]);
            const update = (key, val) => setState(prev => ({...prev, [key]: val}));

            const calc = () => {
                const getD = (nce, ni, lapses) => {
                    let d = 0;
                    if(nce===1) d+=2; else if(nce>=2) d+=3;
                    if(ni===2) d+=1; else if(ni>2 && ni<=5) d+=2; else if(ni>5) d+=3;
                    let lapseDefects = 0;
                    if(lapses >= 4 && lapses <= 5) lapseDefects = 1;
                    else if(lapses > 5 && lapses <= 7) lapseDefects = 2;
                    else if(lapses > 7) lapseDefects = 3;
                    return { total: d + lapseDefects, lapseDefects };
                };
                const getG = (ex, def, isL) => {
                    if(def>=5) return 'F';
                    if(def===0) return ex >= (isL?5:4) ? 'A' : 'B';
                    if(def===1) return 'C'; if(def===2) return 'D'; return 'F';
                };
                let cStats = getD(state.cNCE, state.cNI, state.cLapses);
                let lStats = getD(state.lNCE, state.lNI, state.lLapses);
                let cg = getG(state.cE, cStats.total, false);
                let lg = getG(state.lE, lStats.total, true);
                if(state.missed || cStats.total>=5 || lStats.total>=5) return { grade: 'F', cd: cStats.total, ld: lStats.total };
                const map = {'AA':'A+','AB':'A','AC':'B+','AD':'B','AF':'C+','BB':'B+','BC':'B','BD':'C+','BF':'C','CC':'C+','CD':'C','CF':'D+','DD':'D+','DF':'D','FF':'F'};
                let key = [cg, lg].sort().join('');
                return { grade: map[key] || 'F', cd: cStats.total, ld: lStats.total };
            };

            const result = calc();
            const gClass = `grade-${result.grade.charAt(0)}`;

            return (
                <div className="calc-container">
                    <div className="calc-grid">
                        <div className="calc-section">
                            <h3 className="calc-section-title" style={{color:'var(--color-concept)'}}>
                                <Icons.Concept/> Concepts
                            </h3>
                            <Counter label="Exceeds (E)" val={state.cE} onChange={v => update('cE', v)} />
                            <Counter label="Needs Imp. (NI)" val={state.cNI} onChange={v => update('cNI', v)} />
                            <Counter label="No Credit (NCE)" val={state.cNCE} onChange={v => update('cNCE', v)} />
                            <Counter label="Lapses (زلات)" val={state.cLapses} onChange={v => update('cLapses', v)} />
                        </div>
                        <div className="calc-section">
                            <h3 className="calc-section-title" style={{color:'var(--color-lab)'}}>
                                <Icons.Lab/> Lab
                            </h3>
                            <Counter label="Exceeds (E)" val={state.lE} onChange={v => update('lE', v)} />
                            <Counter label="Needs Imp. (NI)" val={state.lNI} onChange={v => update('lNI', v)} />
                            <Counter label="No Credit (NCE)" val={state.lNCE} onChange={v => update('lNCE', v)} />
                            <Counter label="Lapses (زلات)" val={state.lLapses} onChange={v => update('lLapses', v)} />
                        </div>
                    </div>
                    
                    <div className={`missed-btn ${state.missed ? 'active' : ''}`} onClick={() => update('missed', !state.missed)}>
                        <div className="missed-info">
                            <span className="missed-title">{state.missed ? "فاتني الاختبار (رسوب)" : "حضور الاختبار النهائي"}</span>
                            <span className="missed-sub">{state.missed ? "احذر! سيؤدي هذا إلى الرسوب الفوري." : "اضغط للتبديل في حال عدم الحضور."}</span>
                        </div>
                    </div>

                    <div className="grade-result">
                        <div style={{color:'#888', marginBottom:'5px'}}>الدرجة المتوقعة</div>
                        <div className={`grade-big ${gClass}`}>{result.grade}</div>
                        <div className="defects-text">العيوب: Concepts ({result.cd}) | Lab ({result.ld})</div>
                        <button className="reset-btn" onClick={() => confirm('هل أنت متأكد؟') && setState({cE:0, cNI:0, cNCE:0, cLapses:0, lE:0, lNI:0, lNCE:0, lLapses:0, missed:false})}>تصفير البيانات</button>
                    </div>
                </div>
            );
        };

        const TeamSettingsModal = ({ isOpen, onClose, members, setMembers, settings, setSettings }) => {
            if(!isOpen) return null;
            const handleChange = (i, val) => {
                const newM = [...members]; newM[i] = val; setMembers(newM);
            };
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <button className="modal-close" onClick={onClose}>×</button>
                        <h2 className="modal-title">إعدادات الفريق</h2>
                        
                        <button 
                            className={`timer-toggle-btn ${settings.timer ? 'active' : ''}`}
                            onClick={() => setSettings({...settings, timer: !settings.timer})}
                        >
                            <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                                <Icons.Clock />
                                <span>دور المؤقت (Timer)</span>
                            </div>
                            <span className="timer-status-text">
                                {settings.timer ? 'مفعل' : 'غير مفعل'}
                            </span>
                        </button>

                        <div className="members-grid">
                            {members.map((m, i) => (
                                <div key={i} className="team-member-row">
                                    <span className="member-icon"><Icons.User/></span>
                                    <input 
                                        type="text" 
                                        className="team-input-clean" 
                                        value={m} 
                                        onChange={(e) => handleChange(i, e.target.value)} 
                                        placeholder={`اسم العضو ${i+1}`} 
                                    />
                                </div>
                            ))}
                        </div>

                        <button className="save-btn-new" onClick={onClose}>
                            <Icons.Check/> حفظ الإعدادات
                        </button>
                    </div>
                </div>
            );
        }

		function App() {
            const [tab, setTab] = useState('schedule');
            const [showTeamModal, setShowTeamModal] = useState(false);
            const [teamMembers, setTeamMembers] = useState(() => JSON.parse(localStorage.getItem('ge211_team')) || ["عضو 1", "عضو 2", "عضو 3", "عضو 4", "عضو 5"]);
            const [settings, setSettings] = useState(() => JSON.parse(localStorage.getItem('ge211_settings')) || { timer: true });

            useEffect(() => { localStorage.setItem('ge211_team', JSON.stringify(teamMembers)); }, [teamMembers]);
            useEffect(() => { localStorage.setItem('ge211_settings', JSON.stringify(settings)); }, [settings]);

			return (
				<div className="app">
					<div className="container">
						<header className="header">
                            <button className="team-settings-btn" onClick={() => setShowTeamModal(true)}>
                                <Icons.Users />
                            </button>
                            
                            <a href="https://t.me/MUTLAQ1" target="_blank" className="author-link">
                                إعداد: مطلق
                            </a>

							<h1 className="title">GE 211</h1>
							<p className="subtitle">Introduction to Engineering Design</p>
						</header>

                        <div className="nav-tabs">
                            <button className={`tab-btn ${tab==='schedule'?'active':''}`} onClick={()=>setTab('schedule')}>الجدول</button>
                            <button className={`tab-btn ${tab==='resources'?'active':''}`} onClick={()=>setTab('resources')}>المحتوى</button>
                            <button className={`tab-btn ${tab==='grades'?'active':''}`} onClick={()=>setTab('grades')}>الحاسبة</button>
                        </div>

                        {tab === 'schedule' && <ScheduleView openTeamSettings={() => setShowTeamModal(true)} teamMembers={teamMembers} settings={settings} />}
                        {tab === 'resources' && <ContentView />}
                        {tab === 'grades' && <GradeView />}

                        <TeamSettingsModal 
                            isOpen={showTeamModal} 
                            onClose={() => setShowTeamModal(false)} 
                            members={teamMembers} setMembers={setTeamMembers}
                            settings={settings} setSettings={setSettings}
                        />
					</div>
				</div>
			);
		}
		
		const root = ReactDOM.createRoot(document.getElementById("root"));
		root.render(<StrictMode><App /></StrictMode>);
	</script>
</body>
</html>
